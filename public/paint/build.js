!function(t){function e(s){if(i[s])return i[s].exports;var n=i[s]={exports:{},id:s,loaded:!1};return t[s].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){window.saveAs=i(1).saveAs,i(4),i(5),i(6),i(7),i(8),i(9),i(10),i(11),i(12),i(13),i(14),i(15),i(16),i(17),i(18),i(19),i(20),i(21),i(22),i(23),i(24),i(25),i(26),i(27),i(28),i(29),i(30),i(31),i(32),i(33)},function(t,e,i){var s,n,o=o||function(t){"use strict";if(!("undefined"==typeof t||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var e=t.document,i=function(){return t.URL||t.webkitURL||t},s=e.createElementNS("http://www.w3.org/1999/xhtml","a"),n="download"in s,o=function(t){var e=new MouseEvent("click");t.dispatchEvent(e)},r=/constructor/i.test(t.HTMLElement),a=/CriOS\/[\d]+/.test(navigator.userAgent),h=function(e){(t.setImmediate||t.setTimeout)(function(){throw e},0)},c="application/octet-stream",d=4e4,l=function(t){var e=function(){"string"==typeof t?i().revokeObjectURL(t):t.remove()};setTimeout(e,d)},u=function(t,e,i){e=[].concat(e);for(var s=e.length;s--;){var n=t["on"+e[s]];if("function"==typeof n)try{n.call(t,i||t)}catch(t){h(t)}}},m=function(t){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob([String.fromCharCode(65279),t],{type:t.type}):t},p=function(e,h,d){d||(e=m(e));var p,b=this,g=e.type,v=g===c,E=function(){u(b,"writestart progress write writeend".split(" "))},f=function(){if((a||v&&r)&&t.FileReader){var s=new FileReader;return s.onloadend=function(){var e=a?s.result:s.result.replace(/^data:[^;]*;/,"data:attachment/file;"),i=t.open(e,"_blank");i||(t.location.href=e),e=void 0,b.readyState=b.DONE,E()},s.readAsDataURL(e),void(b.readyState=b.INIT)}if(p||(p=i().createObjectURL(e)),v)t.location.href=p;else{var n=t.open(p,"_blank");n||(t.location.href=p)}b.readyState=b.DONE,E(),l(p)};return b.readyState=b.INIT,n?(p=i().createObjectURL(e),void setTimeout(function(){s.href=p,s.download=h,o(s),E(),l(p),b.readyState=b.DONE})):void f()},b=p.prototype,g=function(t,e,i){return new p(t,e||t.name||"download",i)};return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(t,e,i){return e=e||t.name||"download",i||(t=m(t)),navigator.msSaveOrOpenBlob(t,e)}:(b.abort=function(){},b.readyState=b.INIT=0,b.WRITING=1,b.DONE=2,b.error=b.onwritestart=b.onprogress=b.onwrite=b.onabort=b.onerror=b.onwriteend=null,g)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof t&&t.exports?t.exports.saveAs=o:null!==i(2)&&null!==i(3)&&(s=[],n=function(){return o}.apply(e,s),!(void 0!==n&&(t.exports=n)))},function(t,e){t.exports=function(){throw new Error("define cannot be used indirect")}},function(t,e){(function(e){t.exports=e}).call(e,{})},function(t,e){window.addEventListener("load",function(t){var e=document.body;e.addEventListener("dragover",function(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy"},!1),e.addEventListener("drop",function(t){t.stopPropagation(),t.preventDefault();for(var e=t.dataTransfer.files,i=0;i<e.length;i++){var s=e[i];if(".apa"===s.name.substr(s.name.length-4).toLowerCase()){var n=new FileReader;n.onload=function(t){document.querySelector("a-scene").systems.brush.loadBinary(t.target.result)},n.readAsArrayBuffer(s)}else if(".json"===s.name.substr(s.name.length-5).toLowerCase()){var n=new FileReader;n.onload=function(t){document.querySelector("a-scene").systems.brush.loadJSON(JSON.parse(t.target.result))},n.readAsText(s)}else".obj"===s.name.substr(s.name.length-4).toLowerCase()?(n=new FileReader,n.onload=function(t){for(var e=new AFRAME.THREE.OBJLoader,i=e.parse(t.target.result),s=document.createElement("a-entity"),n=0;n<i.children.length;n++){var o=i.children[n];o.material.color.set("#333")}s.setObject3D("mesh",i),s.className="templateitem",document.querySelector("a-scene").appendChild(s)},n.readAsText(s)):s.type.match(/image.*/)&&(n=new FileReader,n.onload=function(t){var e=new Image;e.src=t.target.result;var i,s;e.width>e.height?(i=1,s=e.height/e.width):(s=1,i=e.width/e.height);var n=[3*Math.random()-1.5,1+Math.random()-.5,-1.4+.2*Math.random()],o=document.createElement("a-image");o.setAttribute("src",t.target.result),o.setAttribute("position",n.join(" ")),o.setAttribute("width",i),o.setAttribute("height",s),o.className="templateitem",document.querySelector("a-scene").appendChild(o)},n.readAsDataURL(s))}},!1)})},function(t,e){window.BinaryManager=function(t){this.dataview=new DataView(t),this.offset=0,this.isLittleEndian=!0},window.BinaryManager.prototype={readQuaternion:function(){return new THREE.Quaternion(this.readFloat(),this.readFloat(),this.readFloat(),this.readFloat())},readVector3:function(){return new THREE.Vector3(this.readFloat(),this.readFloat(),this.readFloat())},readString:function(){for(var t=this.dataview.getUint8(this.offset++,!0),e="",i=0;i<t;i++)e+=String.fromCharCode(this.dataview.getUint8(this.offset++,!0));return e},readColor:function(){return new THREE.Color(this.readFloat(),this.readFloat(),this.readFloat())},readFloat:function(){var t=this.dataview.getFloat32(this.offset,!0);return this.offset+=4,t},readUint32:function(){var t=this.dataview.getUint32(this.offset,!0);return this.offset+=4,t},readUint16:function(){var t=this.dataview.getUint16(this.offset,!0);return this.offset+=2,t},readUint8:function(){var t=this.dataview.getUint8(this.offset,!0);return this.offset++,t},writeVector:function(t){this.writeFloat32Array(t.toArray())},writeColor:function(t){this.writeFloat32Array(t.toArray())},writeString:function(t){this.writeUint8(t.length);for(var e=0;e<t.length;e++)this.writeUint8(t.charCodeAt(e))},writeUint8:function(t){this.dataview.setUint8(this.offset,t,this.isLittleEndian),this.offset++},writeUint16:function(t){this.dataview.setUint16(this.offset,t,this.isLittleEndian),this.offset+=2},writeUint32:function(t){this.dataview.setUint32(this.offset,t,this.isLittleEndian),this.offset+=4},writeFloat32:function(t){this.dataview.setFloat32(this.offset,t,this.isLittleEndian),this.offset+=4},writeFloat32Array:function(t){for(var e=0;e<t.length;e++)this.writeFloat32(t[e])},getDataView:function(){return this.dataview}}},function(t,e){THREE.OrbitControls=function(t,e){function i(){return 2*Math.PI/60/60*C.autoRotateSpeed}function s(){return Math.pow(.95,C.zoomSpeed)}function n(t){U.theta-=t}function o(t){U.phi-=t}function r(t){C.object instanceof THREE.PerspectiveCamera?W/=t:C.object instanceof THREE.OrthographicCamera?(C.object.zoom=Math.max(C.minZoom,Math.min(C.maxZoom,C.object.zoom*t)),C.object.updateProjectionMatrix(),Q=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),C.enableZoom=!1)}function a(t){C.object instanceof THREE.PerspectiveCamera?W*=t:C.object instanceof THREE.OrthographicCamera?(C.object.zoom=Math.max(C.minZoom,Math.min(C.maxZoom,C.object.zoom/t)),C.object.updateProjectionMatrix(),Q=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),C.enableZoom=!1)}function h(t){_.set(t.clientX,t.clientY)}function c(t){X.set(t.clientX,t.clientY)}function d(t){q.set(t.clientX,t.clientY)}function l(t){Y.set(t.clientX,t.clientY),Z.subVectors(Y,_);var e=C.domElement===document?C.domElement.body:C.domElement;n(2*Math.PI*Z.x/e.clientWidth*C.rotateSpeed),o(2*Math.PI*Z.y/e.clientHeight*C.rotateSpeed),_.copy(Y),C.update()}function u(t){K.set(t.clientX,t.clientY),$.subVectors(K,X),$.y>0?r(s()):$.y<0&&a(s()),X.copy(K),C.update()}function m(t){G.set(t.clientX,t.clientY),J.subVectors(G,q),it(J.x,J.y),q.copy(G),C.update()}function p(t){}function b(t){t.deltaY<0?a(s()):t.deltaY>0&&r(s()),C.update()}function g(t){switch(t.keyCode){case C.keys.UP:it(0,C.keyPanSpeed),C.update();break;case C.keys.BOTTOM:it(0,-C.keyPanSpeed),C.update();break;case C.keys.LEFT:it(C.keyPanSpeed,0),C.update();break;case C.keys.RIGHT:it(-C.keyPanSpeed,0),C.update()}}function v(t){_.set(t.touches[0].pageX,t.touches[0].pageY)}function E(t){var e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY,s=Math.sqrt(e*e+i*i);X.set(0,s)}function f(t){q.set(t.touches[0].pageX,t.touches[0].pageY)}function y(t){Y.set(t.touches[0].pageX,t.touches[0].pageY),Z.subVectors(Y,_);var e=C.domElement===document?C.domElement.body:C.domElement;n(2*Math.PI*Z.x/e.clientWidth*C.rotateSpeed),o(2*Math.PI*Z.y/e.clientHeight*C.rotateSpeed),_.copy(Y),C.update()}function M(t){var e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY,n=Math.sqrt(e*e+i*i);K.set(0,n),$.subVectors(K,X),$.y>0?a(s()):$.y<0&&r(s()),X.copy(K),C.update()}function w(t){G.set(t.touches[0].pageX,t.touches[0].pageY),J.subVectors(G,q),it(J.x,J.y),q.copy(G),C.update()}function A(t){}function T(t){if(C.enabled!==!1){if(t.preventDefault(),t.button===C.mouseButtons.ORBIT){if(C.enableRotate===!1)return;h(t),k=N.ROTATE}else if(t.button===C.mouseButtons.ZOOM){if(C.enableZoom===!1)return;c(t),k=N.DOLLY}else if(t.button===C.mouseButtons.PAN){if(C.enablePan===!1)return;d(t),k=N.PAN}k!==N.NONE&&(document.addEventListener("mousemove",S,!1),document.addEventListener("mouseup",j,!1),C.dispatchEvent(I))}}function S(t){if(C.enabled!==!1)if(t.preventDefault(),k===N.ROTATE){if(C.enableRotate===!1)return;l(t)}else if(k===N.DOLLY){if(C.enableZoom===!1)return;u(t)}else if(k===N.PAN){if(C.enablePan===!1)return;m(t)}}function j(t){C.enabled!==!1&&(p(t),document.removeEventListener("mousemove",S,!1),document.removeEventListener("mouseup",j,!1),C.dispatchEvent(z),k=N.NONE)}function x(t){C.enabled===!1||C.enableZoom===!1||k!==N.NONE&&k!==N.ROTATE||(t.preventDefault(),t.stopPropagation(),b(t),C.dispatchEvent(I),C.dispatchEvent(z))}function R(t){C.enabled!==!1&&C.enableKeys!==!1&&C.enablePan!==!1&&g(t)}function L(t){if(C.enabled!==!1){switch(t.touches.length){case 1:if(C.enableRotate===!1)return;v(t),k=N.TOUCH_ROTATE;break;case 2:if(C.enableZoom===!1)return;E(t),k=N.TOUCH_DOLLY;break;case 3:if(C.enablePan===!1)return;f(t),k=N.TOUCH_PAN;break;default:k=N.NONE}k!==N.NONE&&C.dispatchEvent(I)}}function P(t){if(C.enabled!==!1)switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:if(C.enableRotate===!1)return;if(k!==N.TOUCH_ROTATE)return;y(t);break;case 2:if(C.enableZoom===!1)return;if(k!==N.TOUCH_DOLLY)return;M(t);break;case 3:if(C.enablePan===!1)return;if(k!==N.TOUCH_PAN)return;w(t);break;default:k=N.NONE}}function O(t){C.enabled!==!1&&(A(t),C.dispatchEvent(z),k=N.NONE)}function D(t){t.preventDefault()}this.object=t,this.domElement=void 0!==e?e:document,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-(1/0),this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return F.phi},this.getAzimuthalAngle=function(){return F.theta},this.reset=function(){C.target.copy(C.target0),C.object.position.copy(C.position0),C.object.zoom=C.zoom0,C.object.updateProjectionMatrix(),C.dispatchEvent(H),C.update(),k=N.NONE},this.update=function(){var e=new THREE.Vector3,s=(new THREE.Quaternion).setFromUnitVectors(t.up,new THREE.Vector3(0,1,0)),o=s.clone().inverse(),r=new THREE.Vector3,a=new THREE.Quaternion;return function(){var t=C.object.position;return e.copy(t).sub(C.target),e.applyQuaternion(s),F.setFromVector3(e),C.autoRotate&&k===N.NONE&&n(i()),F.theta+=U.theta,F.phi+=U.phi,F.theta=Math.max(C.minAzimuthAngle,Math.min(C.maxAzimuthAngle,F.theta)),F.phi=Math.max(C.minPolarAngle,Math.min(C.maxPolarAngle,F.phi)),F.makeSafe(),F.radius*=W,F.radius=Math.max(C.minDistance,Math.min(C.maxDistance,F.radius)),C.target.add(V),e.setFromSpherical(F),e.applyQuaternion(o),t.copy(C.target).add(e),C.object.lookAt(C.target),C.enableDamping===!0?(U.theta*=1-C.dampingFactor,U.phi*=1-C.dampingFactor):U.set(0,0,0),W=1,V.set(0,0,0),!!(Q||r.distanceToSquared(C.object.position)>B||8*(1-a.dot(C.object.quaternion))>B)&&(C.dispatchEvent(H),r.copy(C.object.position),a.copy(C.object.quaternion),Q=!1,!0)}}(),this.dispose=function(){C.domElement.removeEventListener("contextmenu",D,!1),C.domElement.removeEventListener("mousedown",T,!1),C.domElement.removeEventListener("wheel",x,!1),C.domElement.removeEventListener("touchstart",L,!1),C.domElement.removeEventListener("touchend",O,!1),C.domElement.removeEventListener("touchmove",P,!1),document.removeEventListener("mousemove",S,!1),document.removeEventListener("mouseup",j,!1),window.removeEventListener("keydown",R,!1)};var C=this,H={type:"change"},I={type:"start"},z={type:"end"},N={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},k=N.NONE,B=1e-6,F=new THREE.Spherical,U=new THREE.Spherical,W=1,V=new THREE.Vector3,Q=!1,_=new THREE.Vector2,Y=new THREE.Vector2,Z=new THREE.Vector2,q=new THREE.Vector2,G=new THREE.Vector2,J=new THREE.Vector2,X=new THREE.Vector2,K=new THREE.Vector2,$=new THREE.Vector2,tt=function(){var t=new THREE.Vector3;return function(e,i){t.setFromMatrixColumn(i,0),t.multiplyScalar(-e),V.add(t)}}(),et=function(){var t=new THREE.Vector3;return function(e,i){t.setFromMatrixColumn(i,1),t.multiplyScalar(e),V.add(t)}}(),it=function(){var t=new THREE.Vector3;return function(e,i){var s=C.domElement===document?C.domElement.body:C.domElement;if(C.object instanceof THREE.PerspectiveCamera){var n=C.object.position;t.copy(n).sub(C.target);var o=t.length();o*=Math.tan(C.object.fov/2*Math.PI/180),tt(2*e*o/s.clientHeight,C.object.matrix),et(2*i*o/s.clientHeight,C.object.matrix)}else C.object instanceof THREE.OrthographicCamera?(tt(e*(C.object.right-C.object.left)/C.object.zoom/s.clientWidth,C.object.matrix),et(i*(C.object.top-C.object.bottom)/C.object.zoom/s.clientHeight,C.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),C.enablePan=!1)}}();C.domElement.addEventListener("contextmenu",D,!1),C.domElement.addEventListener("mousedown",T,!1),C.domElement.addEventListener("wheel",x,!1),C.domElement.addEventListener("touchstart",L,!1),C.domElement.addEventListener("touchend",O,!1),C.domElement.addEventListener("touchmove",P,!1),window.addEventListener("keydown",R,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(t){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!t}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(t){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!t}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(t){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!t}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(t){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!t}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(t){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!t}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(t){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=t}}})},function(t,e){window.Utils=function(){function t(t){return parseFloat(t.toFixed(s))}function e(e){for(var i=0;i<e.length;i++)e[i]=t(e[i]);return this}function i(t){var e,i;switch(t){case"windows-motion-controls":i=".windows-motion-tooltips";break;case"oculus-touch-controls":i=".oculus-tooltips";break;case"vive-controls":i=".vive-tooltips"}return e=Array.prototype.slice.call(document.querySelectorAll(i))}const s=6;return{numberToFixed:t,arrayNumbersToFixed:e,getTooltips:i}}()},function(t,e){window.addEventListener("load",function(t){var e=document.getElementById("apainter-ui"),i=document.querySelector("#apainter-ui .share"),s=document.getElementById("apainter-share-url"),n=document.querySelector("#apainter-ui .progress"),o=document.querySelector("#apainter-ui .bar");document.addEventListener("drawing-upload-completed",function(t){AFRAME.scenes[0].systems.xr.supportAR||(i.classList.remove("hide"),n.classList.add("hide"),s.value=t.detail.url)}),document.addEventListener("drawing-upload-started",function(t){AFRAME.scenes[0].systems.xr.supportAR||(e.style.display="block",i.classList.add("hide"),n.classList.remove("hide"))}),document.addEventListener("drawing-upload-progress",function(t){AFRAME.scenes[0].systems.xr.supportAR||(o.style.width=Math.floor(100*t.detail.progress)+"%")});var r=new Clipboard(".button.copy");r.on("error",function(t){console.error("Error copying to clipboard:",t.action,t.trigger)})})},function(t,e){AFRAME.registerSystem("xr",{schema:{AR_AUTOSTART:{default:!0}},init:function(){this.el.sceneEl.setAttribute("vr-mode-ui",{enabled:!1}),this.sceneEl.addEventListener("loaded",this.sceneLoaded.bind(this))},sceneLoaded:function(){var t=this;THREE.WebXRUtils.getDisplays().then(t.initXR.bind(t))},initXR:function(t){this.supportAR=!1;for(var e=0;e<t.length;e++){const i=t[e];i.supportedRealities.ar&&(this.supportAR=!0)}this.el.emit("xrInitialized");var s=document.querySelector("[camera]");if(this.el.sceneEl.setAttribute("visible",!0),!this.supportAR)return void this.el.sceneEl.setAttribute("vr-mode-ui",{enabled:!0});s.removeAttribute("orbit-controls"),this.displays=t,this.posePosition=new THREE.Vector3,this.poseQuaternion=new THREE.Quaternion,this.poseEuler=new THREE.Euler(0,0,0,"YXZ"),this.poseRotation=new THREE.Vector3,this.poseIsLost=!0,this.activeRealityType="magicWindow",this.updateFrame=this.updateFrame.bind(this),this.sessionStarted=this.sessionStarted.bind(this),this.sessionEnded=this.sessionEnded.bind(this),this.poseLost=this.poseLost.bind(this),this.poseFound=this.poseFound.bind(this),this.wrapSceneMethods=this.wrapSceneMethods.bind(this);var n=this;this.wrapSceneMethods(),this.el.camera?this.cameraActivated():this.el.addEventListener("camera-set-active",function(t){n.cameraActivated()})},wrapSceneMethods:function(){var t=this.sceneEl;t._enterVR=t.enterVR,t._exitVR=t.exitVR,t._resize=t.resize,t._render=t.render;var e=this;t.enterAR=function(){this.renderer.xr.startSession(e.lastARDisplay,"ar")},t.exitAR=function(){this.renderer.xr.stopSession()},t.enterVR=function(i){!this.renderer.xr.sessionActive&&e.lastVRDisplay?this.renderer.xr.startSession(e.lastVRDisplay,"vr"):t._enterVR(i)},t.exitVR=function(){this.renderer.xr.sessionActive&&this.renderer.xr.stopSession(),t._exitVR()},t.resize=function(){if(this.renderer.xr&&!this.renderer.xr.sessionActive){var t=this.camera,e={height:window.innerHeight,width:window.innerWidth};t.aspect=e.width/e.height,t.updateProjectionMatrix()}},t.render=function(){var e=1e3*t.clock.getDelta(),i=t.renderer;t.time=1e3*t.clock.elapsedTime,t.isPlaying&&t.tick(t.time,e),i.animate(t.render.bind(t)),t.renderer.xr&&(!t.renderer.xr.session||t.renderer.xr.session&&!t.renderer.xr.sessionActive)&&(i.setSize(window.innerWidth,window.innerHeight),i.render(t.object3D,t.camera,t.renderTarget)),t.isPlaying&&t.tock(t.time,e)},this.continueXR(this.displays)},continueXR:function(t){var e=this.sceneEl;e.renderer.autoClear=!1,document.documentElement.style.backgroundColor="transparent",document.body.style.backgroundColor="transparent";var i={AR_AUTOSTART:this.data.AR_AUTOSTART};e.renderer.xr=new THREE.WebXRManager(i,t,e.renderer,e.camera,e.object3D,this.updateFrame),e.renderer.xr.addEventListener("sessionStarted",this.sessionStarted),e.renderer.xr.addEventListener("sessionEnded",this.sessionEnded),e.renderer.xr.addEventListener("poseLost",this.poseLost),e.renderer.xr.addEventListener("poseFound",this.poseFound),0===e.renderer.xr.totalSupportedDisplays?this.sceneEl.setAttribute("vr-mode-ui",{enabled:!0}):e.renderer.xr.autoStarted||this.addEnterButtons(t)},cameraActivated:function(){this.defaultPosition=new THREE.Vector3(0,1.6,.1),this.el.camera.el.setAttribute("position",this.defaultPosition),this.el.emit("realityChanged","magicWindow")},addEnterButtons:function(t){for(var e=0;e<t.length;e++){var i=t[e];i.supportedRealities.vr&&(this.lastVRDisplay=i,this.sceneEl.setAttribute("vr-mode-ui",{enabled:!0})),i.supportedRealities.ar&&(this.lastARDisplay=i,this.sceneEl.setAttribute("ar-mode-ui",{enabled:!0}))}},sessionStarted:function(t){this.activeRealityType=t.session.realityType,this.el.emit("realityChanged",this.activeRealityType)},sessionEnded:function(t){this.activeRealityType="magicWindow",this.el.emit("realityChanged",this.activeRealityType)},poseLost:function(){this.el.emit("poseLost")},poseFound:function(){this.el.emit("poseFound")},updateFrame:function(t){this.el.emit("updateFrame",t)}})},function(t,e){var s=1;AFRAME.BRUSHES={},AFRAME.registerBrush=function(t,e,i){function s(t){return function(e,i,s,n){this.object3D=new THREE.Object3D,this.data={points:[],size:i,prevPosition:null,prevPointerPosition:null,numPoints:0,color:e.clone(),timestamp:n,owner:s},t.call(this,e,i)}}function n(t){return function(e,i,s,n,o){this.data.prevPosition&&this.data.prevPosition.distanceTo(e)<=this.options.spacing||0!==this.options.maxPoints&&this.data.numPoints>=this.options.maxPoints||t.call(this,e,i,s,n,o)&&(this.data.numPoints++,this.data.points.push({position:e.clone(),orientation:i.clone(),pressure:n,timestamp:o}),this.data.prevPosition=e.clone(),this.data.prevPointerPosition=s.clone())}}var o={};if(Object.keys(e).forEach(function(t){o[t]={value:e[t],writable:!0}}),AFRAME.BRUSHES[t])throw new Error("The brush `"+t+"` has been already registered. Check that you are not loading two versions of the same brush or two different brushes of the same name.");var r=function(){},a={spacing:0,maxPoints:0};r.prototype={options:Object.assign(a,i),reset:function(){},tick:function(t,e){},addPoint:function(t,e,i,s,n){},getJSON:function(t){for(var e=[],i=0;i<this.data.points.length;i++){var s=this.data.points[i];e.push({orientation:Utils.arrayNumbersToFixed(s.orientation.toArray()),position:Utils.arrayNumbersToFixed(s.position.toArray()),pressure:Utils.numberToFixed(s.pressure),timestamp:s.timestamp})}return{brush:{index:t.getUsedBrushes().indexOf(this.brushName),color:Utils.arrayNumbersToFixed(this.data.color.toArray()),size:Utils.numberToFixed(this.data.size)},points:e}},getBinary:function(t){var e=21+36*this.data.points.length,i=new BinaryManager(new ArrayBuffer(e));i.writeUint8(t.getUsedBrushes().indexOf(this.brushName)),i.writeColor(this.data.color),i.writeFloat32(this.data.size),i.writeUint32(this.data.points.length);for(var s=0;s<this.data.points.length;s++){var n=this.data.points[s];AFRAME.scenes[0].object3D.drawingOffset&&n.position.sub(AFRAME.scenes[0].object3D.drawingOffset),i.writeFloat32Array(n.position.toArray()),i.writeFloat32Array(n.orientation.toArray()),i.writeFloat32(n.pressure),i.writeUint32(n.timestamp)}return i.getDataView()}};var h=function(){};return h.prototype=Object.create(r.prototype,o),h.prototype.brushName=t,h.prototype.constructor=h,h.prototype.init=s(h.prototype.init),h.prototype.addPoint=n(h.prototype.addPoint),AFRAME.BRUSHES[t]=h,h.used=!1,h},AFRAME.registerSystem("brush",{schema:{},brushes:{},strokes:[],getUsedBrushes:function(){return Object.keys(AFRAME.BRUSHES).filter(function(t){return AFRAME.BRUSHES[t].used})},getBrushByName:function(t){return AFRAME.BRUSHES[t]},undo:function(){for(var t,e=this.strokes.length-1;e>=0;e--)if("local"===this.strokes[e].data.owner){t=this.strokes.splice(e,1)[0];break}if(t){var i=t.entity;i.emit("stroke-removed",{entity:i}),i.parentNode.removeChild(i)}},clear:function(){for(var t=0;t<this.strokes.length;t++)if("local"===this.strokes[t].data.owner){var e=this.strokes[t].entity;e.emit("stroke-removed",{entity:e}),e.parentNode.removeChild(e)}Object.keys(AFRAME.BRUSHES).forEach(function(t){AFRAME.BRUSHES[t].used=!1}),this.strokes=[]},init:function(){this.version=s,this.clear(),this.controllerName=null,this.offset=new THREE.Vector3;var t=this;this.sceneEl.addEventListener("controllerconnected",function(e){t.controllerName=e.detail.name})},tick:function(t,e){if(this.strokes.length)for(var i=0;i<this.strokes.length;i++)this.strokes[i].tick(t,e)},generateRandomStrokes:function(t){function e(){return 2*Math.random()-1}for(var i=0;i<t;i++){var s="flat",n=new THREE.Color(Math.random(),Math.random(),Math.random()),o=.1*Math.random(),r=parseInt(500*Math.random()),a=this.addNewStroke(s,n,o),h=document.querySelector("#left-hand");h.emit("stroke-started",{entity:h,stroke:a});for(var c=new THREE.Vector3(e(),e(),e()),d=new THREE.Vector3,l=new THREE.Quaternion,u=.2,m=0;m<r;m++){d.set(e(),e(),e()),d.multiplyScalar(e()/20),l.setFromUnitVectors(c.clone().normalize(),d.clone().normalize()),c=c.add(d);var p=0,b=this.getPointerPosition(c,l);a.addPoint(c,l,b,u,p)}}},addNewStroke:function(t,e,i,s,n){s=s||"local",n=n||Date.now();var o=this.getBrushByName(t);if(!o){var r=Object.keys(AFRAME.BRUSHES)[0];o=AFRAME.BRUSHES[r],console.warn("Invalid brush name: `"+t+"` using `"+r+"`")}o.used=!0;var a=new o;a.brush=o,a.init(e,i,s,n),this.strokes.push(a);var h=document.querySelector(".a-drawing");h||(h=document.createElement("a-entity"),h.className="a-drawing",document.querySelector("a-scene").appendChild(h));var c=document.createElement("a-entity");return c.className="a-stroke",h.appendChild(c),c.setObject3D("mesh",a.object3D),a.entity=c,a},getJSON:function(){var t={version:s,strokes:[],author:"",brushes:this.getUsedBrushes()};for(i=0;i<this.strokes.length;i++)t.strokes.push(this.strokes[i].getJSON(this));return t},getBinary:function(){var t=[],e="apainter",i=this.getUsedBrushes(),n=e.length+i.join(" ").length+9,o=new BinaryManager(new ArrayBuffer(n));o.writeString(e),o.writeUint16(s),o.writeUint8(i.length);for(var r=0;r<i.length;r++)o.writeString(i[r]);for(o.writeUint32(this.strokes.length),t.push(o.getDataView()),r=0;r<this.strokes.length;r++)t.push(this.strokes[r].getBinary(this));return t},getPointerPosition:function(){var t=new THREE.Vector3,e={"vive-controls":{vec:new THREE.Vector3(0,.7,1),mult:-.03},"oculus-touch-controls":{vec:new THREE.Vector3(0,0,2.8),mult:-.05},"windows-motion-controls":{vec:new THREE.Vector3(0,0,1),mult:-.12}};return function(i,s){if(!this.controllerName)return i;var n=e[this.controllerName],o=n.vec.clone().applyQuaternion(s).normalize().multiplyScalar(n.mult);return t.copy(i).add(o),t}}(),loadJSON:function(t){t.version!==s&&console.error("Invalid version: ",t.version,"(Expected: "+s+")");for(var e=0;e<t.strokes.length;e++)for(var i=t.strokes[e],n=i.brush,o=this.addNewStroke(t.brushes[n.index],(new THREE.Color).fromArray(n.color),n.size),r=0;r<i.points.length;r++){var a=i.points[r],h=(new THREE.Vector3).fromArray(a.position);this.offset&&h.add(this.offset);var c=(new THREE.Quaternion).fromArray(a.orientation),d=a.pressure,l=a.timestamp,u=this.getPointerPosition(h,c);o.addPoint(h,c,u,d,l)}},loadBinary:function(t){var e=new BinaryManager(t),i=e.readString();if("apainter"!==i)return void console.error("Invalid `magic` header");var n=e.readUint16();n!==s&&console.error("Invalid version: ",n,"(Expected: "+s+")");for(var o=e.readUint8(),r=[],a=0;a<o;a++)r.push(e.readString());for(var h=e.readUint32(),c=0;c<h;c++)for(var d=e.readUint8(),l=e.readColor(),u=e.readFloat(),m=e.readUint32(),p=this.addNewStroke(r[d],l,u),b=0;b<m;b++){var g=e.readVector3();this.offset&&g.add(this.offset);var v=e.readQuaternion(),E=e.readFloat(),f=e.readUint32(),y=this.getPointerPosition(g,v);p.addPoint(g,v,y,E,f)}},loadFromUrl:function(t,e){var i=new THREE.XHRLoader(this.manager);i.crossOrigin="anonymous",e===!0&&i.setResponseType("arraybuffer");var s=this;i.load(t,function(t){s.bufferLoaded=t,s.isBufferLoadedBinary=e,setTimeout(function(){AFRAME.scenes[0].systems.xr.supportAR||s.loadOnceAllIsDone()},2e3)})},addOffset:function(t){this.offset=t,this.isBufferLoadedBinary&&this.loadOnceAllIsDone()},loadOnceAllIsDone:function(){this.isBufferLoadedBinary===!0?this.loadBinary(this.bufferLoaded):this.loadJSON(JSON.parse(this.bufferLoaded))}})},function(t,e){AFRAME.registerSystem("ui",{init:function(){this.initTextures()},initTextures:function(){function t(t){i.hoverTexture=t}function e(t){i.pressedTexture=t}var i=this,s="assets/images/ui-hover.png",n="assets/images/ui-pressed.png";this.sceneEl.systems.material.loadTexture(s,{src:s},t),this.sceneEl.systems.material.loadTexture(n,{src:n},e)},closeAll:function(){var t,e=document.querySelectorAll("[ui]");for(t=0;t<e.length;t++)e[t].components.ui.close()}})},function(t,e,i){var s=i(1).saveAs;AFRAME.registerSystem("painter",{init:function(){function t(){var t,e=/\+/g,i=/([^&=]+)=?([^&]*)/g,s=function(t){return decodeURIComponent(t.replace(e," "))},n=window.location.search.substring(1),o={};for(t=i.exec(n);t;)o[s(t[1])]=s(t[2]),t=i.exec(n);return o}var e={default:{common:{gripdown:"undo",triggerchanged:"paint"},"vive-controls":{axismove:"changeBrushSizeInc",trackpadtouchstart:"startChangeBrushSize",menudown:"toggleMenu",trackpaddown:"aim",trackpadup:"teleport"},"oculus-touch-controls":{axismove:"changeBrushSizeAbs",abuttondown:"toggleMenu",xbuttondown:"toggleMenu",ybuttondown:"aim",ybuttonup:"teleport",bbuttondown:"aim",bbuttonup:"teleport"},"windows-motion-controls":{axismove:"changeBrushSizeAbs",menudown:"toggleMenu",trackpaddown:"aim",trackpadup:"teleport"}}};this.sceneEl.addEventListener("loaded",function(){AFRAME.registerInputMappings(e)}),this.version="1.1",this.brushSystem=this.sceneEl.systems.brush,this.showTemplateItems=!0;var i=t();if(i.url||i.urljson){var s=void 0===i.urljson;this.brushSystem.loadFromUrl(i.url||i.urljson,s),document.getElementById("acamera").setAttribute("orbit-controls","position","0 1.6 3")}void 0!==i.bgcolor&&(document.body.style.backgroundColor="#"+i.bgcolor),void 0!==i.sky&&this.sceneEl.addEventListener("loaded",function(t){""===i.sky?document.getElementById("sky").setAttribute("visible",!1):document.getElementById("sky").setAttribute("material","src",i.sky)}),void 0!==i.floor&&this.sceneEl.addEventListener("loaded",function(t){""===i.floor?document.getElementById("ground").setAttribute("visible",!1):document.getElementById("ground").setAttribute("material","src",i.floor)}),document.addEventListener("keyup",function(t){if(!t.shiftKey&&!t.ctrlKey){if(8===t.keyCode&&self.brushSystem.undo(),67===t.keyCode&&self.brushSystem.clear(),71===t.keyCode){var e=document.querySelector(".a-drawing");self.sceneEl.systems["gltf-exporter"].export(e)}if(78===t.keyCode){var i=document.querySelectorAll("[paint-controls]"),s=Object.keys(AFRAME.BRUSHES),n=s.indexOf(i[0].components.brush.data.brush);n=(n+1)%s.length,[].forEach.call(i,function(t){t.setAttribute("brush","brush",s[n])})}if(82===t.keyCode&&self.brushSystem.generateRandomStrokes(1),
76===t.keyCode&&self.brushSystem.loadFromUrl("demo.apa",!0),85===t.keyCode&&self.upload(),86===t.keyCode&&self.save(),74===t.keyCode&&self.saveJSON(),79===t.keyCode){self.showTemplateItems=!self.showTemplateItems;for(var o=document.querySelectorAll(".templateitem"),r=0;r<o.length;r++)o[r].setAttribute("visible",self.showTemplateItems)}}}),console.info("A-PAINTER Version: "+this.version)},saveJSON:function(){var t=this.brushSystem.getJSON(),e=new Blob([JSON.stringify(t)],{type:"application/json"});s(e,"demo.json")},save:function(){var t=this.brushSystem.getBinary(),e=new Blob(t,{type:"application/octet-binary"});s(e,"demo.apa")},upload:function(t,e){this.sceneEl.emit("drawing-upload-started");var i=this,s="https://aframe.io/a-painter/?url=";AFRAME.scenes[0].systems.xr.supportAR&&(s="");var n=this.brushSystem.getBinary(),o=new Blob(n,{type:"application/octet-binary"}),r="uploadcare";if("fileio"===r){var a=new window.FormData;a.append("file",o);var h=new window.XMLHttpRequest;h.open("POST","https://file.io"),h.onreadystatechange=function(n){if(4===h.readyState){var o=JSON.parse(h.response);o.success&&(console.log("Uploaded link: ",s+o.link),i.sceneEl.emit("drawing-upload-completed",{url:s+o.link}),t&&t())}else i.sceneEl.emit("drawing-upload-error",{errorInfo:null,fileInfo:null}),e&&e()},h.send(a)}else{var c=uploadcare.fileFrom("object",o);c.done(function(e){console.log("Uploaded link: ",s+e.cdnUrl),i.sceneEl.emit("drawing-upload-completed",{url:s+e.cdnUrl}),t&&t()}).fail(function(t,s){i.sceneEl.emit("drawing-upload-error",{errorInfo:t,fileInfo:s}),e&&e(t)}).progress(function(t){i.sceneEl.emit("drawing-upload-progress",{progress:t.progress})})}}})},function(t,e){AFRAME.registerComponent("ar-paint-controls",{schema:{mode:{default:"normal"}},dependencies:["brush"],init:function(){this.bindMethods(),this.pressure=0,this.activePaintMode=this.data.mode,this.enablePaintMode(this.activePaintMode),this.el.addEventListener("stroke-started",this.onStrokeStarted),document.querySelector("[ar-ui]").addEventListener("activate",this.activate.bind(this)),document.querySelector("[ar-ui]").addEventListener("deactivate",this.deactivate.bind(this)),document.querySelector("[ar-ui]").addEventListener("onBrushChanged",this.onBrushChanged.bind(this)),document.querySelector("[ar-ui]").addEventListener("objectsUIIntersected",this.objectsUIIntersected.bind(this)),document.querySelector("a-scene").addEventListener("updateFrame",this.updateFrame)},bindMethods:function(){this.onStrokeStarted=this.onStrokeStarted.bind(this),this.startHandler=this.paintStart.bind(this),this.moveHandler=this.paintMove.bind(this),this.endHandler=this.paintEnd.bind(this),this.updateFrame=this.updateFrame.bind(this)},onStrokeStarted:function(){this.el.emit("brush-started")},activate:function(){this.el.sceneEl.isMobile?(window.addEventListener("touchstart",this.startHandler),window.addEventListener("touchmove",this.moveHandler),window.addEventListener("touchend",this.endHandler)):(window.addEventListener("mousedown",this.startHandler),window.addEventListener("mousemove",this.moveHandler),window.addEventListener("mouseup",this.endHandler))},deactivate:function(){this.el.sceneEl.isMobile?(window.removeEventListener("touchstart",this.startHandler),window.removeEventListener("touchmove",this.moveHandler),window.removeEventListener("touchend",this.endHandler)):(window.removeEventListener("mousedown",this.startHandler),window.removeEventListener("mousemove",this.moveHandler),window.removeEventListener("mouseup",this.endHandler))},onBrushChanged:function(t){t.detail.brush.color!==this.el.getAttribute("brush").color&&this.el.setAttribute("brush","color",t.detail.brush.color),this.pressure=t.detail.pressure,t.detail.brush!==this.el.getAttribute("brush").brush&&this.el.setAttribute("brush","brush",t.detail.brush.brush),this.el.setAttribute("brush","size",t.detail.brush.size),this.el.emit("brushchanged",{brush:t.detail.brush,pressure:t.detail.pressure,uiTouched:this.uiTouched})},objectsUIIntersected:function(t){t.detail.intersections>0?this.uiTouched=!0:this.uiTouched=!1},paintStart:function(t){this.uiTouched||this.el.emit("paintplaced",{touchEvent:t})},paintMove:function(t){if(!this.uiTouched){this.eventTouch=t;var e=this.el;return e.components.brush.active?void(t.touches&&"stylus"===t.touches[0].touchType?(this.stylusActive=!0,e.components.brush.sizeModifier=this.pressure):(this.stylusActive=!1,1!==e.components.brush.sizeModifier&&(this.pressure=0),e.components.brush.sizeModifier=1)):void this.el.emit("paintstarted",{touchEvent:t,brush:e.components.brush})}},paintEnd:function(t){var e=this.el;e.components.brush.active&&(e.components.brush.currentStroke=null,e.components.brush.active=!1,this.el.emit("paintended"))},enablePaintMode:function(t){this.el.setAttribute("ar-paint-"+t,{brush:this.el.getAttribute("brush").brush,color:this.el.getAttribute("brush").color,size:this.el.getAttribute("brush").size,defaultSize:this.el.components.brush.schema.size.default,min:this.el.components.brush.schema.size.min,max:this.el.components.brush.schema.size.max})},disablePaintMode:function(t){this.el.removeAttribute("ar-paint-"+t)},switchPaintMode:function(t){this.disablePaintMode(this.activePaintMode),this.activePaintMode=t,this.enablePaintMode(this.activePaintMode)},updateSchema:function(t){t.mode&&this.activePaintMode&&this.activePaintMode!==t.mode&&this.switchPaintMode(t.mode)},updateFrame:function(t){this.el.components.brush.active&&this.el.emit("paintpainting",{touchEvent:this.eventTouch,stylusActive:this.stylusActive})}})},function(t,e){function i(t){var e;return e=document.createElement("button"),e.className=o,e.setAttribute("title","Enter AR mode."),e.setAttribute("aframe-injected",""),e.addEventListener("click",function(e){document.getElementsByClassName(o)[0].style.display="none",document.getElementsByClassName(r)[0].style.display="inline-block",t()}),e}function s(t){var e;return e=document.createElement("button"),e.className=r,e.setAttribute("title","Exit AR mode."),e.setAttribute("aframe-injected",""),e.addEventListener("click",function(e){document.getElementsByClassName(o)[0].style.display="inline-block",document.getElementsByClassName(r)[0].style.display="none",t()}),e}var n="a-enter-vr",o="a-enter-ar-button",r="a-exit-ar-button",a="a-hidden";AFRAME.registerComponent("ar-mode-ui",{dependencies:["canvas"],schema:{enabled:{default:!0}},init:function(){var t=this,e=this.el;if("false"!==AFRAME.utils.getUrlParameter("ui")){var i=document.createElement("style");i.innerHTML=".a-enter-vr {text-align: center;right: 10px;}",i.innerHTML+=".a-enter-vr-button {background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNS4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkNhcGFfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiDQoJIHdpZHRoPSIyMDQ4cHgiIGhlaWdodD0iMjA0OHB4IiB2aWV3Qm94PSIwIDAgMjA0OCAyMDQ4IiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCAyMDQ4IDIwNDgiIHhtbDpzcGFjZT0icHJlc2VydmUiPg0KPHRpdGxlPm1hc2s8L3RpdGxlPg0KPGc+DQoJPHJlY3QgeD0iMTQ0LjIzMiIgeT0iNTg3LjI3NiIgZmlsbD0ibm9uZSIgd2lkdGg9IjE4NjYuMTg3IiBoZWlnaHQ9IjEzNDEuMTM0Ii8+DQoJPHBhdGggZmlsbD0iI0ZGRkZGRiIgZD0iTTc4MS42NjksNTg2LjU4OWgxOTguNzk3bC0zMTQuMTI1LDkyMUg0ODUuNzAxbC0zMTEuODEyLTkyMWgyMDUuNjU2bDIwMC4xODgsNjk5LjE4OEw3ODEuNjY5LDU4Ni41ODl6Ii8+DQoJPHBhdGggZmlsbD0iI0ZGRkZGRiIgZD0iTTE2ODYuMjc5LDYxMC4zMjRjMzMuOTM4LDE0LjU3OCw2Mi43MDMsMzYuMDMxLDg2LjI4MSw2NC4zNDRjMTkuNTE2LDIzLjMyOCwzNC45NjksNDkuMTU2LDQ2LjM0NCw3Ny40NjkNCgkJczE3LjA3OCw2MC41OTQsMTcuMDc4LDk2LjgxMmMwLDQzLjcxOS0xMS4wNDcsODYuNzE5LTMzLjE0MSwxMjguOTg0Yy0yMi4wOTQsNDIuMjgxLTU4LjU0Nyw3Mi4xNTctMTA5LjM5MSw4OS42NDENCgkJYzQyLjM3NSwxNy4xMjUsNzIuMzkxLDQxLjQzOCw5MC4wNDcsNzIuOTUzYzE3LjY1NiwzMS41MzEsMjYuNDg0LDc5LjU2MiwyNi40ODQsMTQ0LjA5NHY2MS44MjgNCgkJYzAsNDIuMDYyLDEuNzAzLDcwLjU3OCw1LjEyNSw4NS41NjJjNS4xMjUsMjMuNzUsMTcuMDc4LDQxLjIzNCwzNS44NzUsNTIuNDY5djIzLjEwOWgtMjEyLjMyOA0KCQljLTUuNzgxLTIwLjQwNi05LjkwNi0zNi44NDQtMTIuMzc1LTQ5LjM0NGMtNC45NjktMjUuODEyLTcuNjU2LTUyLjI1LTguMDYyLTc5LjMxMmwtMS4yMzQtODUuNTc4DQoJCWMtMC43OTctNTguNzAzLTEwLjk2OS05Ny44NDQtMzAuNTMxLTExNy40MDZzLTU2LjIxOS0yOS4zNTktMTA5Ljk1My0yOS4zNTloLTE4OC41MTZ2MzYxaC0xODh2LTkyMWg0NDAuODc1DQoJCUMxNjAzLjg1Nyw1ODcuODM5LDE2NTIuMzQyLDU5NS43NjEsMTY4Ni4yNzksNjEwLjMyNHogTTEyODcuOTgyLDc0NS41ODl2MjQ4aDIwNy41MzFjNDEuMjE5LDAsNzIuMTQxLTUsOTIuNzY2LTE1LjAzMQ0KCQljMzYuNDY5LTE3LjUzMSw1NC43MDMtNTIuMTcyLDU0LjcwMy0xMDMuOTUzYzAtNTUuOTM4LTE3LjY0MS05My41MTYtNTIuOTIyLTExMi43MzRjLTE5LjgyOC0xMC44NDQtNDkuNTYyLTE2LjI4MS04OS4yMDMtMTYuMjgxDQoJCUgxMjg3Ljk4MnoiLz4NCjwvZz4NCjwvc3ZnPg0K) 50% 50%/70% 70% no-repeat rgba(0,0,0,.35);",i.innerHTML+="position: relative;",i.innerHTML+="margin-right: 10px;",i.innerHTML+="}",i.innerHTML+=".a-enter-ar-button {background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNS4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkNhcGFfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiDQoJIHdpZHRoPSIyMDQ4cHgiIGhlaWdodD0iMjA0OHB4IiB2aWV3Qm94PSIwIDAgMjA0OCAyMDQ4IiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCAyMDQ4IDIwNDgiIHhtbDpzcGFjZT0icHJlc2VydmUiPg0KPHRpdGxlPm1hc2s8L3RpdGxlPg0KPGc+DQoJPHBhdGggZmlsbD0iI0ZGRkZGRiIgZD0iTTQzOS45NzIsNTg0LjgzNWgyMTcuNjI1bDMyNS4zNDUsOTIxaC0yMDguNzJsLTYwLjU3Ny0xODloLTMzOS4yNWwtNjIuNDIzLDE4OWgtMjAxLjExTDQzOS45NzIsNTg0LjgzNXoNCgkJIE00MjYuODc4LDExNTcuODM1aDIzNS44MTJMNTQ2LjU1LDc5NS4zOTZMNDI2Ljg3OCwxMTU3LjgzNXoiLz4NCgk8cGF0aCBmaWxsPSIjRkZGRkZGIiBkPSJNMTY5MC43MjMsNjA4LjU2OWMzMy45MzgsMTQuNTc3LDYyLjcwMiwzNi4wMyw4Ni4yOCw2NC4zNDRjMTkuNTE3LDIzLjMyOCwzNC45Nyw0OS4xNTYsNDYuMzQ1LDc3LjQ2OQ0KCQljMTEuMzc1LDI4LjMxMywxNy4wNzcsNjAuNTk0LDE3LjA3Nyw5Ni44MTJjMCw0My43MTktMTEuMDQ3LDg2LjcxOS0zMy4xNDEsMTI4Ljk4M2MtMjIuMDk1LDQyLjI4MS01OC41NDcsNzIuMTU2LTEwOS4zOTIsODkuNjQyDQoJCWM0Mi4zNzUsMTcuMTI1LDcyLjM5Miw0MS40MzgsOTAuMDQ3LDcyLjk1MmMxNy42NTYsMzEuNTMxLDI2LjQ4NCw3OS41NjIsMjYuNDg0LDE0NC4wOTV2NjEuODI4DQoJCWMwLDQyLjA2MiwxLjcwMyw3MC41NzcsNS4xMjUsODUuNTYyYzUuMTI1LDIzLjc1LDE3LjA3OCw0MS4yMzQsMzUuODc1LDUyLjQ2OXYyMy4xMDloLTIxMi4zMjgNCgkJYy01Ljc4MS0yMC40MDYtOS45MDYtMzYuODQ0LTEyLjM3NS00OS4zNDRjLTQuOTY5LTI1LjgxMi03LjY1Ni01Mi4yNS04LjA2Mi03OS4zMTJsLTEuMjM0LTg1LjU3OA0KCQljLTAuNzk3LTU4LjcwMy0xMC45NjktOTcuODQ0LTMwLjUzLTExNy40MDVjLTE5LjU2Mi0xOS41NjItNTYuMjItMjkuMzU5LTEwOS45NTMtMjkuMzU5aC0xODguNTE3djM2MWgtMTg4di05MjFIMTU0NS4zDQoJCUMxNjA4LjMsNTg2LjA4NSwxNjU2Ljc4NCw1OTQuMDA3LDE2OTAuNzIzLDYwOC41Njl6IE0xMjkyLjQyNSw3NDMuODM1djI0OGgyMDcuNTMxYzQxLjIxOSwwLDcyLjE0Mi01LDkyLjc2Ny0xNS4wMzENCgkJYzM2LjQ2OS0xNy41Myw1NC43MDItNTIuMTcyLDU0LjcwMi0xMDMuOTUzYzAtNTUuOTM4LTE3LjY0MS05My41MTYtNTIuOTIyLTExMi43MzNjLTE5LjgyOC0xMC44NDQtNDkuNTYyLTE2LjI4MS04OS4yMDMtMTYuMjgxDQoJCUwxMjkyLjQyNSw3NDMuODM1TDEyOTIuNDI1LDc0My44MzV6Ii8+DQo8L2c+DQo8L3N2Zz4NCg==) 50% 50%/70% 70% no-repeat rgba(0,0,0,.35);",i.innerHTML+="border: 0;",i.innerHTML+="bottom: 0;",i.innerHTML+="cursor: pointer;",i.innerHTML+="min-width: 50px;",i.innerHTML+="min-height: 30px;",i.innerHTML+="padding-right: 5%;",i.innerHTML+="padding-top: 4%;",i.innerHTML+="transition: background-color .05s ease;",i.innerHTML+="-webkit-transition: background-color .05s ease;",i.innerHTML+="z-index: 9999;",i.innerHTML+="margin-right: 10px;}",i.innerHTML+=".a-enter-ar-button:active,.a-enter-ar-button:hover { background-color: #666;",i.innerHTML+="}",i.innerHTML+=".a-exit-ar-button {background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNS4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkNhcGFfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiDQoJIHdpZHRoPSIyMDQ4cHgiIGhlaWdodD0iMjA0OHB4IiB2aWV3Qm94PSIwIDAgMjA0OCAyMDQ4IiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCAyMDQ4IDIwNDgiIHhtbDpzcGFjZT0icHJlc2VydmUiPg0KPHRpdGxlPm1hc2s8L3RpdGxlPg0KPHJlY3QgeD0iNTYxLjI3MyIgeT0iNTg0LjgzNiIgZmlsbD0ibm9uZSIgd2lkdGg9IjEzODMuMTM5IiBoZWlnaHQ9IjEzODMuMTM5Ii8+DQo8ZyBlbmFibGUtYmFja2dyb3VuZD0ibmV3ICAgICI+DQoJPHBhdGggZmlsbD0iI0ZGRkZGRiIgZD0iTTgwNi41MDgsMTUwNS4xNDhINTgyLjc3NGwyOTYuMDE2LTQ2OS4yNWwtMjgyLjAxNi00NTEuNzVoMjMwLjA0N2wxNjQuNDM4LDMwMC4wMTZsMTY4Ljk2OC0zMDAuMDE2DQoJCWgyMjIuNTQ3bC0yODIuMDE2LDQ0NC4yNWwzMDAuMDE2LDQ3Ni43NWgtMjMzLjg5MWwtMTc1LjUzMS0zMTQuMTU2TDgwNi41MDgsMTUwNS4xNDh6Ii8+DQo8L2c+DQo8L3N2Zz4NCg==) 50% 50%/70% 70% no-repeat rgba(0,0,0,.35);",i.innerHTML+="border: 0;",i.innerHTML+="bottom: 0;",i.innerHTML+="cursor: pointer;",i.innerHTML+="min-width: 30px;",i.innerHTML+="min-height: 30px;",i.innerHTML+="padding-right: 5%;",i.innerHTML+="padding-top: 4%;",i.innerHTML+="transition: background-color .05s ease;",i.innerHTML+="-webkit-transition: background-color .05s ease;",i.innerHTML+="z-index: 9999;",i.innerHTML+="display: none;",i.innerHTML+="margin-right: 10px;}",i.innerHTML+=".a-exit-ar-button:active,.a-exit-ar-button:hover { background-color: #666;",i.innerHTML+="}",document.body.appendChild(i),this.enterAR=e.enterAR.bind(e),this.exitAR=e.exitAR.bind(e),this.insideLoader=!1,this.enterAREl=null,e.addEventListener("enter-vr",this.updateEnterARInterface.bind(this)),e.addEventListener("exit-vr",this.updateEnterARInterface.bind(this)),window.addEventListener("message",function(e){"loaderReady"===e.data.type&&(t.insideLoader=!0,t.remove())})}},update:function(){var t=this.el;if(!this.data.enabled||this.insideLoader||"false"===AFRAME.utils.getUrlParameter("ui"))return this.remove();if(!this.enterAREl){if(this.enterAREl=i(this.enterAR),this.exitAREl=s(this.exitAR),!document.getElementsByClassName(n)[0]){var e=document.createElement("div");e.classList.add(n),e.setAttribute("aframe-injected",""),t.appendChild(e)}document.getElementsByClassName(n)[0].appendChild(this.enterAREl),document.getElementsByClassName(n)[0].appendChild(this.exitAREl),this.updateEnterARInterface()}},remove:function(){[this.enterAREl].forEach(function(t){t&&t.parentNode.removeChild(t)})},updateEnterARInterface:function(){this.toggleEnterARButtonIfNeeded()},toggleEnterARButtonIfNeeded:function(){var t=this.el;this.enterAREl&&(t.is("vr-mode")?(this.enterAREl.classList.add(a),this.exitAREl.classList.add(a)):(this.enterAREl.classList.remove(a),this.exitAREl.classList.remove(a)))}})},function(t,e){AFRAME.registerComponent("ar-pin",{init:function(){this.xrInitialized=this.xrInitialized.bind(this),this.realityChanged=this.realityChanged.bind(this),this.scene=document.querySelector("a-scene"),this.scene.addEventListener("xrInitialized",this.xrInitialized),this.scene.addEventListener("realityChanged",this.realityChanged)},xrInitialized:function(){if(this.xrIsInit=!0,this.drawingOffset=new THREE.Vector3,!AFRAME.scenes[0].systems.xr.supportAR){var t=document.querySelector("#ar-paint-controls");return void t.parentNode.removeChild(t)}this.updateFrame=this.updateFrame.bind(this),this.normalizedCoordinatedPositionPointer=new THREE.Vector2,this.coordinatesToFindAnchors=new THREE.Vector2(.5,.5),this.hammer=new Hammer(this.scene),this.startHandler=this.startHandler.bind(this),this.moveHandler=this.moveHandler.bind(this),this.endHandler=this.endHandler.bind(this),this.tapHandler=this.tapHandler.bind(this),window.addEventListener("touchstart",this.startHandler),window.addEventListener("touchmove",this.moveHandler),window.addEventListener("touchend",this.endHandler),this.hammer.on("tap",this.tapHandler),this.anchoredNodes=[],this.drawingContainer=document.querySelector("#drawing-container"),this.drawing=document.querySelector(".a-drawing"),this.pinSelected=!1,this.pinIntersected=!1,this.pin=new THREE.Group,this.el.object3D.add(this.pin);var e=new THREE.RingGeometry(.05,.06,8);e.applyMatrix((new THREE.Matrix4).makeRotationX(THREE.Math.degToRad(-90)));var i=new THREE.MeshBasicMaterial({color:16777215,opacity:.6,transparent:!0});this.ringTop=new THREE.Mesh(e,i),this.ringTop.position.y=.02;var s=new THREE.MeshBasicMaterial({color:0,opacity:.25,transparent:!0});this.ringShadow=new THREE.Mesh(e,s),this.ringShadow.position.y=-.001;var n=new THREE.CircleGeometry(.12,8);n.applyMatrix((new THREE.Matrix4).makeRotationX(THREE.Math.degToRad(-90)));var o=new THREE.MeshBasicMaterial({opacity:0,transparent:!0,depthTest:!1,depthWrite:!1});this.collider=new THREE.Mesh(n,o),this.pin.add(this.ringTop),this.pin.add(this.ringShadow),this.pin.add(this.collider);var r=new THREE.PlaneGeometry(100,100);r.applyMatrix((new THREE.Matrix4).makeRotationX(THREE.Math.degToRad(-90)));var a=new THREE.MeshBasicMaterial({color:16777215,transparent:!0,opacity:.25});a.blending=THREE.CustomBlending,a.blendEquation=THREE.AddEquation,a.blendSrc=THREE.ZeroFactor,a.blendDst=THREE.SrcAlphaFactor,this.floor=new THREE.Mesh(r,a),document.querySelector("#drawing-container").object3D.add(this.floor),this.pin.visible=!1;var h=this;this.tweenFloating=new AFRAME.TWEEN.Tween({valuePosY:.02,valueScale:1,valueOpacity:.25}).to({valuePosY:.03,valueScale:1.05,valueOpacity:.15},1e3).onUpdate(function(){h.ringTop.position.y=this.valuePosY,h.ringShadow.scale.x=this.valueScale,h.ringShadow.scale.z=this.valueScale,h.ringShadow.material.opacity=this.valueOpacity}).yoyo(!0).easing(TWEEN.Easing.Quadratic.InOut).repeat(1/0),this.tweenFloating.start(),this.isNotStartedYet&&this.start()},realityChanged:function(t){"ar"===t.detail&&(AFRAME.scenes[0].systems.xr.supportAR?this.xrIsInit?this.start():this.isNotStartedYet=!0:this.sceneEl.systems.brush.addOffset(this.drawingOffset))},start:function(){this.raycaster=new THREE.Raycaster,this.scene.addEventListener("updateFrame",this.updateFrame)},startHandler:function(t){this.setPinIntersected(t),this.pinIntersected&&(this.ringTop.material.opacity=1,this.pin.scale.set(1.2,1.2,1.2))},moveHandler:function(t){this.setPinIntersected(t)},endHandler:function(t){this.ringTop.material.opacity=.6,this.pin.scale.set(1,1,1),this.pinIntersected=!1},tapHandler:function(t){if(this.pin.visible&&this.pinIntersected){this.drawingOffset=this.pin.getWorldPosition(),this.el.sceneEl.object3D.drawingOffset=this.drawingOffset,this.el.sceneEl.systems.brush.addOffset(this.drawingOffset),this.pinSelected=!0,this.ringTop.material.opacity=1,this.ringTop.position.y=-5e-4;var e=this;new AFRAME.TWEEN.Tween({valueScale:1,valueOpacity:.25}).to({valueScale:3,valueOpacity:0},1e3).onUpdate(function(){e.ringShadow.scale.x=this.valueScale,e.ringShadow.scale.z=this.valueScale,e.ringShadow.material.opacity=this.valueOpacity}).easing(TWEEN.Easing.Quadratic.Out).onComplete(function(){e.ringShadow.visible=!1}).start(),this.collider.visible=!1,this.pin.scale.set(1,1,1),this.tweenFloating.stop(),this.el.emit("pinselected")}},setCoordinates:function(t){var e=t;t.touches&&(e=t.touches[0]),this.normalizedCoordinatedPositionPointer.x=e.clientX/this.el.sceneEl.canvas.clientWidth*2-1,this.normalizedCoordinatedPositionPointer.y=2*-(e.clientY/this.el.sceneEl.canvas.clientHeight)+1,this.coordinatesToFindAnchors.x=e.clientX/window.innerWidth,this.coordinatesToFindAnchors.y=e.clientY/window.innerHeight},setPinIntersected:function(t){this.setCoordinates(t),this.raycaster.setFromCamera(this.normalizedCoordinatedPositionPointer,this.el.sceneEl.camera);var e=this.raycaster.intersectObjects([this.collider]);this.pinIntersected=e.length>0,e.length>0&&this.setPinPosition(e[0].point)},setPinPosition:function(t){this.pin.position.x=t.x,this.pin.position.z=t.z},addAnchoredNode:function(t,e){this.anchoredNodes.push({anchorOffset:t,node:e}),this.el.sceneEl.object3D.add(e)},updatePinFromAnchorOffset:function(t,e){const i=t.getAnchor(e.anchorUID);if(null!==i){var s=(new THREE.Matrix4).fromArray(e.getOffsetTransform(i.coordinateSystem));this.pin.position.setFromMatrixPosition(s),this.floor.position.y=this.pin.position.y-.005,this.pin.quaternion.setFromRotationMatrix(s),this.originalPinPosition=this.pin.position.clone()}},updateFrame:function(t){if(!this.pinSelected){var e=this;t.detail.findAnchor(this.coordinatesToFindAnchors.x,this.coordinatesToFindAnchors.y).then(function(i){null===i||(e.pin.visible=!0,e.el.emit("pindetected"),e.updatePinFromAnchorOffset(t.detail,i),e.scene.removeEventListener("updateFrame",e.updateFrame))}).catch(function(t){console.error("Error in hit test",t)})}}})},function(t,e){AFRAME.registerComponent("ar-ui",{init:function(){document.querySelector("a-scene").addEventListener("realityChanged",this.realityChanged.bind(this))},realityChanged:function(t){"ar"===t.detail&&this.start()},start:function(){function t(){e.setPressure(),e.bindMethods(),e.initRaycaster(),e.addContainers(),e.setLayoutSettings(),e.addEvents(),e.addUIElements(),e.initUI(),setTimeout(function(){e.onWindowResize()},500)}var e=this;this.depth=-.1,this.modalOpened=null,this.colorStack=["#272727","#727272","#FFFFFF","#24CAFF","#249F90","#F2E646","#EF2D5E"],this.brushRegexp=/^(?!.*(fg|bg)$)brush[0-9]+/,this.colorHistoryRegexp=/^(?!.*(fg|bg)$)colorhistory[0-9]+$/,this.hsv={h:0,s:0,v:1},this.brushButtonsMapping={},this.colorHasChanged=!0,this.pressedObjects={},this.selectedObjects={},this.pressure=1,this.tapped=!1,this.strokeNormalized=.5,this.scaleFactor=1,this.renderOrderUI=1e4,this.renderOrderModal=10001,this.paintMode=1,this.atlasData='{"total": {"w": 2048, "h": 2048 }, "images": {"apainterBtn": { "x": 0, "y": 1536, "w": 512, "h": 512 },"trackingLost": { "x": 1536, "y": 1536, "w": 512, "h": 512 },"brushBtn": { "x": 0, "y": 1024, "w": 512, "h": 512 },"closeBtn": { "x": 1536, "y": 1280, "w": 256, "h": 256 },"trackingDevice": { "x": 1280, "y": 1280, "w": 256, "h": 256 },"undoBtn": { "x": 1536, "y": 1024, "w": 256, "h": 256 },"saveBtn": { "x": 1280, "y": 1024, "w": 256, "h": 256 },"strokeDragBar": { "x": 0, "y": 896, "w": 1024, "h": 128 },"strokeDragDot": { "x": 0, "y": 640, "w": 256, "h": 256 },"saved": { "x": 1792, "y": 640, "w": 256, "h": 256 },"moveAroundDevice": { "x": 0, "y": 0, "w": 512, "h": 512 },"moveAround": { "x": 1024, "y": 1792, "w": 1024, "h": 256 },"dragTapPin": { "x": 1024, "y": 1536, "w": 1024, "h": 256 },"saving": { "x": 1024, "y": 1024, "w": 512, "h": 512 },"paintMode1": { "x": 512, "y": 1280, "w": 256, "h": 256 },"paintMode2": { "x": 256, "y": 1280, "w": 256, "h": 256 },"paintMode1Btn": { "x": 512, "y": 1024, "w": 256, "h": 256 },"paintMode2Btn": { "x": 256, "y": 1024, "w": 256, "h": 256 },"showUIAlert": { "x": 1024, "y": 768, "w": 1024, "h": 256 },"hideUIBtn": { "x": 256, "y": 512, "w": 256, "h": 256 }}}',this.atlas=JSON.parse(this.atlasData),this.paintControlsEl=document.querySelector("#ar-paint-controls"),this.objects={};var i=document.getElementById("ar_ui");i.complete?t():i.addEventListener("load",t)},tick:function(t,e){},setPressure:function(){var t=this;Pressure.set(this.el.sceneEl,{change:function(e,i){i.touches&&"stylus"===i.touches[0].touchType&&(t.pressure=e,t.onBrushChanged())}},{only:"touch"})},bindMethods:function(){this.onWindowResize=this.onWindowResize.bind(this),this.tap=this.tap.bind(this),this.tapend=this.tapend.bind(this),this.onmove=this.onmove.bind(this),this.onPoseLost=this.onPoseLost.bind(this),this.onPoseFound=this.onPoseFound.bind(this),this.onModelLoaded=this.onModelLoaded.bind(this),this.onComponentChanged=this.onComponentChanged.bind(this),this.onStrokeStarted=this.onStrokeStarted.bind(this),this.enterPainterMode=this.enterPainterMode.bind(this),this.exitPainterMode=this.exitPainterMode.bind(this),this.undo=this.undo.bind(this),this.save=this.save.bind(this),this.brushBtnClicked=this.brushBtnClicked.bind(this),this.dragStroke=this.dragStroke.bind(this),this.updateFrame=this.updateFrame.bind(this),this.onPinDetected=this.onPinDetected.bind(this),this.onPinSelected=this.onPinSelected.bind(this)},initRaycaster:function(){this.raycaster=new THREE.Raycaster,this.normalizedCoordinatedPositionPointer=new THREE.Vector2,this.intersection=null,this.objOver},updateFrame:function(t){},addContainers:function(){document.querySelector("a-scene").addEventListener("updateFrame",this.updateFrame),this.containerUI=document.createElement("a-entity"),this.containerUI.setAttribute("id","ui-container"),this.el.appendChild(this.containerUI),this.drawingContainer=document.querySelector("#drawing-container"),this.frustumSize=1,this.aspect=window.innerWidth/window.innerHeight,this.orthoCamera=new THREE.OrthographicCamera(this.frustumSize*this.aspect/-2,this.frustumSize*this.aspect/2,this.frustumSize/2,this.frustumSize/-2,.05,.2),document.querySelector("#acamera").object3D.add(this.orthoCamera);var t=this;this.el.sceneEl.renderer.xr.doRender=function(){var e=t.el.sceneEl.camera.el.components["ar-ui"];t.drawingContainer.setAttribute("visible",!0),t.containerUI.setAttribute("visible",!1),t.el.sceneEl.renderer.render(t.el.sceneEl.object3D,t.el.sceneEl.camera),t.drawingContainer.setAttribute("visible",!1),t.containerUI.setAttribute("visible",!0),t.el.sceneEl.renderer.render(t.el.sceneEl.object3D,e.orthoCamera)}},setLayoutSettings:function(){this.paddingTop=this.paddingBottom=this.paddingRight=this.paddingLeft=this.depth/20},addEvents:function(){window.addEventListener("resize",this.onWindowResize),this.el.sceneEl.isMobile?(window.addEventListener("touchstart",this.tap),window.addEventListener("touchmove",this.onmove),window.addEventListener("touchend",this.tapend)):(window.addEventListener("mousedown",this.tap),window.addEventListener("mousemove",this.onmove),window.addEventListener("mouseup",this.tapend)),this.el.addEventListener("model-loaded",this.onModelLoaded),this.el.addEventListener("componentchanged",this.onComponentChanged),document.querySelector("#ar-paint-controls").addEventListener("brush-started",this.onStrokeStarted),document.querySelector("[ar-pin]").addEventListener("pindetected",this.onPinDetected),document.querySelector("[ar-pin]").addEventListener("pinselected",this.onPinSelected);var t=this;this.el.sceneEl.addEventListener("drawing-upload-completed",function(e){t.saved(e.detail.url)}),this.el.sceneEl.addEventListener("drawing-upload-error",function(e){console.log("Error uploading",t.objects.messageError),this.closeModal("saving")})},addUIElements:function(){this.addSounds(),this.addInitEl(),this.addPaintingEls(),this.addCommonEls(),this.addPaintModeEls(),this.addSettingsEls(),this.addSavingEls(),this.addTrackingLostEls()},addSounds:function(){var t=document.createElement("a-sound"),e="";AFRAME.utils.device.isIOS()&&(e="_iOS"),t.setAttribute("src","#ui_click0"+e),t.setAttribute("id","uiClick0"),this.containerUI.appendChild(t),t=document.createElement("a-sound"),t.setAttribute("src","#ui_click1"+e),t.setAttribute("id","uiClick1"),this.containerUI.appendChild(t),t=document.createElement("a-sound"),t.setAttribute("src","#ui_menu"+e),t.setAttribute("id","uiMenu"),this.containerUI.appendChild(t),t=document.createElement("a-sound"),t.setAttribute("src","#ui_undo"+e),t.setAttribute("id","uiUndo"),this.containerUI.appendChild(t)},addInitEl:function(){this.addImage({id:"moveAround",layout:"top-center",visible:!1,width:.06,height:.015,padding:[0,0,0,0]}),this.addImage({id:"moveAroundDevice",layout:"center",visible:!1,width:.02,height:.02,padding:[0,0,0,0],renderOrder:this.renderOrderModal}),this.addImage({id:"dragTapPin",layout:"top-center",visible:!1,width:.06,height:.015,padding:[0,0,0,0]})},addPaintingEls:function(){this.addButton({id:"closeBtn",layout:"top-left",visible:!1,enabled:!1,width:.01,height:.01,padding:[.005,.0015,0,0],onclick:this.exitPainterMode}),this.addButton({id:"undoBtn",layout:"bottom-left",visible:!1,enabled:!1,width:.01,height:.01,padding:[0,.0015,.0175,0],onclick:this.undo}),this.addButton({id:"saveBtn",layout:"top-right",visible:!1,enabled:!1,width:.01,height:.01,padding:[.005,0,0,.0015],onclick:this.save}),this.addButton({id:"paintModeBtn",atlasId:"paintMode1Btn",layout:"bottom-left",visible:!1,enabled:!1,width:.01,height:.01,padding:[0,.0015,.0325,0],onclick:this.openPaintMode.bind(this)}),this.addButton({id:"hideUIBtn",layout:"bottom-right",visible:!1,enabled:!1,width:.0125,height:.0125,padding:[0,0,.01,0],onclick:this.hideUI.bind(this)}),this.addImage({id:"showUIAlert",layout:"top-center",visible:!1,width:.06,height:.015,padding:[0,0,0,0]})},addCommonEls:function(){this.addFader({id:"fader-brushSettings",visible:!1,enabled:!1}),this.addButton({id:"brushBtn",layout:"bottom-center",visible:!1,enabled:!1,width:.015,height:.015,padding:[0,0,.0125,0],onclick:this.brushBtnClicked}),this.addImage({id:"strokeDragBar",layout:"bottom-center",visible:!1,width:.03,height:.00375,padding:[0,0,.0025,0],renderOrder:this.renderOrderModal}),this.addButton({id:"strokeDragDot",layout:"stroke-drag",visible:!1,width:.01,height:.01,padding:[0,0,0,0],renderOrder:this.renderOrderModal}),this.addStrokeOnButton()},addPaintModeEls:function(){this.addFader({id:"fader-paintMode",visible:!1,enabled:!1}),this.addButton({id:"closePaintModeBtn",atlasId:"closeBtn",layout:"top-right",visible:!1,enabled:!1,width:.01,height:.01,padding:[.005,0,0,.0025],onclick:this.closePaintMode.bind(this),renderOrder:this.renderOrderModal}),this.addText({id:"titlePaintModeModal",text:"Select paint mode",font:"FiraSans-Regular",layout:"bottom-center",align:"center",visible:!1,padding:[0,0,.035,0],size:.15}),this.addGroupBtn({id:"paintMode1",icon:"paintMode1",layout:"bottom-center",visible:!1,enabled:!1,padding:[0,0,.03,0],title:"Normal",description:"Touch and move your finger",active:!0,onclick:this.changePaintMode.bind(this,1)}),this.addGroupBtn({id:"paintMode2",icon:"paintMode2",layout:"bottom-center",visible:!1,enabled:!1,padding:[0,0,.01,0],title:"Paint with Helpers",description:"Show additional feedback",active:!1,onclick:this.changePaintMode.bind(this,2)})},addStrokeOnButton:function(){var t=document.createElement("a-entity");this.strokeOnButton=t,t.setAttribute("geometry",{primitive:"circle",radius:.002}),t.setAttribute("position","0 0 0.00001"),t.setAttribute("material",{shader:"flat",transparent:!0,color:"red"});var e=document.createElement("a-entity");e.setAttribute("geometry",{primitive:"circle",radius:.00225}),e.setAttribute("material",{shader:"flat",transparent:!0,color:13421772}),t.appendChild(e),this.objects.strokeDragDot.appendChild(t)},addSettingsEls:function(){this.addButton({id:"closeSettingsBtn",atlasId:"closeBtn",layout:"bottom-right",visible:!1,enabled:!1,width:.01,height:.01,padding:[0,0,.0175,.0025],onclick:this.closeBrushSettings.bind(this),renderOrder:this.renderOrderModal}),this.addSettingsUI()},addSettingsUI:function(){this.settingsUI=document.createElement("a-entity"),this.settingsUI.setAttribute("obj-model","obj:#aruiobj"),this.settingsUI.setAttribute("material",{color:"#ffffff",flatShading:!0,shader:"flat",transparent:!0,fog:!1,src:"#uinormal"}),this.settingsUI.setAttribute("position","0 -0.06 -0.098"),this.settingsUI.setAttribute("scale","3 3 3"),this.settingsUI.setAttribute("visible",!1),this.containerUI.appendChild(this.settingsUI)},onModelLoaded:function(t){var e=this.settingsUI,i=e.getObject3D("mesh");if(i=t.detail.model,"obj"===t.detail.format&&i.getObjectByName("brightnesscursor")){this.objectsSettings={},this.objectsSettings.brightnessCursor=i.getObjectByName("brightnesscursor"),this.objectsSettings.brightnessSlider=i.getObjectByName("brightness"),this.objectsSettings.brightnessSlider.geometry.computeBoundingBox(),this.objectsSettings.previousPage=i.getObjectByName("brushprev"),this.objectsSettings.nextPage=i.getObjectByName("brushnext"),this.objectsSettings.hueCursor=i.getObjectByName("huecursor"),this.objectsSettings.hueWheel=i.getObjectByName("hue"),
this.objectsSettings.hueWheel.geometry.computeBoundingSphere(),this.colorWheelSize=this.objectsSettings.hueWheel.geometry.boundingSphere.radius,this.objectsSettings.colorHistory=[];for(var s=0;s<7;s++)this.objectsSettings.colorHistory[s]=i.getObjectByName("colorhistory"+s);this.objectsSettings.currentColor=i.getObjectByName("currentcolor"),this.el.setAttribute("brush","enabled",!1),this.updateBrushButton(),this.setStrokeBar(this.el.getAttribute("brush").size),this.strokeOnButton.setAttribute("material","color",this.el.getAttribute("brush").color),this.initColorWheel(),this.initColorHistory(),this.initBrushesMenu(),this.setCursorTransparency(),this.updateColorUI(this.el.getAttribute("brush").color),this.adjustRenderOrder()}},adjustRenderOrder:function(){var t=this;this.el.object3D.traverse(function(e){e.renderOrder&&e.children.length&&(e.children[0].renderOrder=e.renderOrder,e.children[0].onBeforeRender=function(){t.el.sceneEl.renderer.clearDepth()})})},onPinDetected:function(){this.tweenMoveAround1&&this.stopMoveAround(),this.hideEl(this,"moveAroundDevice",!1),this.hideEl(this,"moveAround",!1,500),this.showEl(this,"dragTapPin",!1,1e3)},onPinSelected:function(){this.hideEl(this,"dragTapPin",!1);var t=this;setTimeout(function(){t.enterPainterMode()},1e3)},initColorWheel:function(){var t=this.objectsSettings.hueWheel,e="\t      varying vec2 vUv;\t      void main() {\t        vUv = uv;\t        vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\t        gl_Position = projectionMatrix * mvPosition;\t      }\t      ",i="\t      #define M_PI2 6.28318530718\n \t      uniform float brightness;\t      varying vec2 vUv;\t      vec3 hsb2rgb(in vec3 c){\t          vec3 rgb = clamp(abs(mod(c.x * 6.0 + vec3(0.0, 4.0, 2.0), 6.0) - 3.0) - 1.0, \t                           0.0, \t                           1.0 );\t          rgb = rgb * rgb * (3.0 - 2.0 * rgb);\t          return c.z * mix( vec3(1.0), rgb, c.y);\t      }\t      \t      void main() {\t        vec2 toCenter = vec2(0.5) - vUv;\t        float angle = atan(toCenter.y, toCenter.x);\t        float radius = length(toCenter) * 2.0;\t        vec3 color = hsb2rgb(vec3((angle / M_PI2) + 0.5, radius, brightness));\t        gl_FragColor = vec4(color, 1.0);\t      }\t      ",s=new THREE.ShaderMaterial({uniforms:{brightness:{type:"f",value:this.hsv.v}},vertexShader:e,fragmentShader:i,transparent:!0});t.material=s},initColorHistory:function(){for(var t,e=this.objectsSettings.currentColor,i=0;i<this.objectsSettings.colorHistory.length;i++)t=this.objectsSettings.colorHistory[i],t.material=t.material.clone(),t.material.map=null;e.material=e.material.clone(),e.material.map=null,this.updateColorHistory()},updateColorHistory:function(){var t=this.el.getAttribute("brush").color,e=this.colorStack;t||(t=this.el.components.brush.schema.color.default),this.objectsSettings.currentColor.material.color.set(t);for(var i=0;i<e.length;i++)t=e[e.length-i-1],this.objectsSettings.colorHistory[i].material.color.set(t)},initBrushesMenu:function(){var t=this.objectsSettings.previousPage,e=this.objectsSettings.nextPage,i=Object.keys(AFRAME.BRUSHES);t.visible=!1,e.visible=!1,this.brushesPerPage=15,this.brushesPagesNum=Math.ceil(i.length/this.brushesPerPage),this.brushesPage=0,this.loadBrushes(this.brushesPage,this.brushesPerPage)},loadBrushes:function(){var t={};return function(e,i){function s(e,i,s){function o(t){var e=d.getObjectByName("brush"+i);u.brushButtonsMapping["brush"+i]=r,n(t,e)}var r=e?(e.charAt(0).toUpperCase()+e.slice(1)).toLowerCase():void 0;return s&&!t[r]?void u.el.sceneEl.systems.material.loadTexture(s,{src:s},o):void o()}function n(e,i){var s=u.brushButtonsMapping[i.name],n=t[s]||new THREE.MeshBasicMaterial;e?(n.map=e,n.alphaTest=.5,n.transparent=!0):t[s]||(n.visible=!1),t[s]=n,i.material=n}var o,r,a,h,c=0,d=this.settingsUI.getObject3D("mesh"),l=Object.keys(AFRAME.BRUSHES),u=this;if(!(e<0||e>=this.brushesPagesNum))for(0===e?this.objectsSettings.previousPage.visible=!1:this.objectsSettings.previousPage.visible=!0,e===this.brushesPagesNum-1?this.objectsSettings.nextPage.visible=!1:this.objectsSettings.nextPage.visible=!0,h=0;h<i;h++)a=e*i+h,o=l[a],r=o&&AFRAME.BRUSHES[o].prototype.options.thumbnail,s(o,c,r),c+=1}}(),nextPage:function(){this.brushesPage>=this.brushesPagesNum-1||(this.brushesPage++,this.loadBrushes(this.brushesPage,this.brushesPerPage))},previousPage:function(){0!==this.brushesPage&&(this.brushesPage--,this.loadBrushes(this.brushesPage,this.brushesPerPage))},setCursorTransparency:function(){var t=this.objectsSettings.hueCursor,e=this.objectsSettings.brightnessCursor;t.material.alphaTest=.5,e.material.alphaTest=.5,t.material.transparent=!0,e.material.transparent=!0},updateColorUI:function(t){var e=new THREE.Color(t),i=this.hsv=this.rgb2hsv(e.r,e.g,e.b),s=2*i.h*Math.PI,n=i.s*this.colorWheelSize,o=n*Math.cos(s),r=n*Math.sin(s);this.objectsSettings.hueCursor.position.setX(o),this.objectsSettings.hueCursor.position.setY(r),this.objectsSettings.hueWheel.material.uniforms.brightness.value=this.hsv.v,this.objectsSettings.brightnessCursor.rotation.z=1.5*this.hsv.v-1.5},onclickSettingsUI:function(t,e){var i=t.name;if("brushSettings"===this.modalOpened){switch(i){case"brightness":this.onBrightnessDown(e);break;case"brushnext":this.pressedObjects[i]||this.nextPage();break;case"brushprev":this.pressedObjects[i]||this.previousPage();break;case"hue":this.onHueDown(e)}this.brushRegexp.test(i)?this.onBrushDown(i):this.colorHistoryRegexp.test(i)&&this.onColorHistoryButtonDown(t),this.pressedObjects[i]=t}},onBrightnessDown:function(t){var e=THREE.Math.mapLinear(t.y,.58,.93,0,1);e=THREE.Math.clamp(1.29*e-.12,0,1),this.objectsSettings.hueWheel.material.uniforms.brightness.value=e,this.objectsSettings.brightnessCursor.rotation.z=1.5*e-1.5,this.hsv.v=e,this.updateColor()},onHueDown:function(t){var e,i=this.colorWheelSize,s=new THREE.Vector3;s.x=.1*(t.x-.5),s.y=.1*(t.y-.5),s.z=this.objectsSettings.hueCursor.position.z,this.objectsSettings.hueCursor.position.copy(s),e={r:Math.sqrt(s.x*s.x+s.y*s.y),theta:Math.PI+Math.atan2(s.y,s.x)};var n=(e.theta*(180/Math.PI)+180)%360;this.hsv.h=n/360,this.hsv.s=e.r/i,this.updateColor()},updateColor:function(){var t=this.hsv2rgb(this.hsv),e="rgb("+t.r+", "+t.g+", "+t.b+")";this.el.setAttribute("brush","color",e),this.onBrushChanged(),this.colorHasChanged=!0},hsv2rgb:function(t){var e,i,s,n,o,r,a,h,c=THREE.Math.clamp(t.h,0,1),d=THREE.Math.clamp(t.s,0,1),l=t.v;switch(n=Math.floor(6*c),o=6*c-n,r=l*(1-d),a=l*(1-o*d),h=l*(1-(1-o)*d),n%6){case 0:e=l,i=h,s=r;break;case 1:e=a,i=l,s=r;break;case 2:e=r,i=l,s=h;break;case 3:e=r,i=a,s=l;break;case 4:e=h,i=r,s=l;break;case 5:e=l,i=r,s=a}return{r:Math.round(255*e),g:Math.round(255*i),b:Math.round(255*s)}},rgb2hsv:function(t,e,i){var s,n=Math.max(t,e,i),o=Math.min(t,e,i),r=n-o,a=0===n?0:r/n,h=n;switch(1===arguments.length&&(e=t.g,i=t.b,t=t.r),n){case o:s=0;break;case t:s=e-i+r*(e<i?6:0),s/=6*r;break;case e:s=i-t+2*r,s/=6*r;break;case i:s=t-e+4*r,s/=6*r}return{h:s,s:a,v:h}},onBrushDown:function(t){var e=this.brushButtonsMapping[t];e&&(this.selectBrushButton(t),this.el.setAttribute("brush","brush",e.toLowerCase()),this.onBrushChanged())},selectBrushButton:function(t){var e=this.settingsUI.getObject3D("mesh").getObjectByName(t+"bg"),i=this.selectedObjects,s=this.selectedBrush;s&&delete i[s.name],i[e.name]=e,this.selectedBrush=e},onColorHistoryButtonDown:function(t){var e=t.material.color.getHexString();this.el.setAttribute("brush","color","#"+e),this.onBrushChanged()},onBrushChanged:function(){this.updateBrushButton(),this.el.emit("onBrushChanged",{brush:this.el.getAttribute("brush"),pressure:this.pressure}),this.strokeOnButton.setAttribute("material","color",this.el.getAttribute("brush").color)},updateBrushButton:function(){var t=this.objects.brushBtn.getObject3D("mesh");if(this.el.getAttribute("brush").brush!==t.brush){var e=AFRAME.BRUSHES[this.el.getAttribute("brush").brush].prototype.options.thumbnail,i=(new THREE.TextureLoader).load(e);t.brush=this.el.getAttribute("brush").brush,t.material.map=i}t.material.color=new THREE.Color(this.el.getAttribute("brush").color)},onComponentChanged:function(t){"brush"===t.detail.name&&this.syncUI()},onStrokeStarted:function(){var t,e=this.colorStack;this.colorHasChanged&&(t=this.el.getAttribute("brush").color,this.colorHasChanged=!1,7===e.length&&e.shift(),e.push(t),this.syncUI())},syncUI:function(){var t;this.objectsSettings&&(t=this.el.getAttribute("brush"),this.updateColorUI(t.color),this.updateColorHistory())},addSavingEls:function(){this.addFader({id:"fader-saving",visible:!1,enabled:!1}),this.addImage({id:"saving",layout:"center",visible:!1,width:.05,height:.05,padding:[0,0,0,0],renderOrder:this.renderOrderModal}),this.addImage({id:"saved",layout:"center",visible:!1,width:.025,height:.025,padding:[0,0,0,0],renderOrder:this.renderOrderModal})},addTrackingLostEls:function(){this.addFader({id:"fader-trackingLost",visible:!1,enabled:!1}),this.addImage({id:"trackingLost",layout:"center",visible:!1,width:.04,height:.04,padding:[0,0,0,0],renderOrder:this.renderOrderModal}),this.addImage({id:"trackingDevice",layout:"center",visible:!1,width:.02,height:.02,padding:[0,0,.01,0],renderOrder:this.renderOrderModal})},initUI:function(){var t=this,e=t.objects.moveAround;e.setAttribute("visible",!0),e.setAttribute("material",{opacity:0}),this.tweenMoveAround=new AFRAME.TWEEN.Tween({value:0}).to({value:.7},500).delay(1e3).onUpdate(function(){e.setAttribute("material",{opacity:this.value})}).easing(AFRAME.TWEEN.Easing.Cubic.In).start();var i=t.objects.moveAroundDevice;i.setAttribute("visible",!0),i.setAttribute("material",{opacity:0}),this.tweenMoveAroundDevice=new AFRAME.TWEEN.Tween({value:0}).to({value:1},500).delay(1500).onUpdate(function(){i.setAttribute("material",{opacity:this.value})}).onComplete(function(){t.moveAroundEl(t,"moveAroundDevice")}).easing(AFRAME.TWEEN.Easing.Cubic.In).start()},addButton:function(t){this.objects[t.id]=document.createElement("a-entity");var e=this.objects[t.id];e.padding=t.padding||[0,0,0,0],e.id=t.id,e.atlasId=t.atlasId||t.id,e.class="ar-ui",e.layout=t.layout,e.onclick=t.onclick,e.setAttribute("geometry",{primitive:"plane",width:t.width,height:t.height}),e.setAttribute("material",{shader:"flat",transparent:!0,fog:!1,src:"#ar_ui",repeat:{x:this.atlas.images[e.atlasId].w/this.atlas.total.w,y:this.atlas.images[e.atlasId].h/this.atlas.total.h},offset:{x:(this.atlas.total.w-this.atlas.images[e.atlasId].x)/this.atlas.total.w,y:this.atlas.images[e.atlasId].y/this.atlas.total.h}}),e.setAttribute("position",{x:0,y:0,z:1e4}),e.setAttribute("visible",t.visible),e.setAttribute("enabled",t.enabled),e.object3D.renderOrder=t.renderOrder||this.renderOrderUI,this.containerUI.appendChild(e)},addFader:function(t){this.objects[t.id]=document.createElement("a-entity");var e=this.objects[t.id];e.addEventListener("model-loaded",this.onModelLoaded),e.padding=t.padding||[0,0,0,0],e.id=t.id,e.class="ar-ui",e.layout="fader",e.setAttribute("geometry",{primitive:"plane",width:.24,height:.24}),e.setAttribute("ar-ui-modal-material",{steps:{x:0,y:.33,z:.66,w:1},opacity:.9}),e.setAttribute("position",{x:0,y:0,z:1e4}),e.setAttribute("visible",t.visible),e.setAttribute("enabled",t.enabled),e.object3D.renderOrder=t.renderOrder||this.renderOrderUI,this.containerUI.appendChild(e)},addImage:function(t){this.objects[t.id]=document.createElement("a-entity");var e=this.objects[t.id];e.padding=t.padding||[0,0,0,0],e.id=t.id,e.atlasId=t.atlasId||t.id,e.class="ar-ui",e.layout=t.layout,e.onclick=t.onclick,e.setAttribute("geometry",{primitive:"plane",width:t.width,height:t.height}),e.setAttribute("material",{shader:"flat",transparent:!0,fog:!1,src:"#ar_ui",repeat:{x:this.atlas.images[e.atlasId].w/this.atlas.total.w,y:this.atlas.images[e.atlasId].h/this.atlas.total.h},offset:{x:(this.atlas.total.w-this.atlas.images[e.atlasId].x)/this.atlas.total.w,y:this.atlas.images[e.atlasId].y/this.atlas.total.h}}),e.setAttribute("position",{x:0,y:0,z:1e4}),e.setAttribute("visible",t.visible),e.object3D.renderOrder=t.renderOrder||this.renderOrderUI,this.containerUI.appendChild(e)},addText:function(t){this.objects[t.id]=document.createElement("a-entity");var e=this.objects[t.id];e.padding=t.padding||[0,0,0,0],e.id=t.id,e.layout=t.layout,e.setAttribute("text",{value:t.text,font:"assets/fonts/"+t.font+".json",align:t.align||"center",shader:"msdf",color:"#FFFFFF"}),e.setAttribute("position",{x:0,y:0,z:1e3}),e.setAttribute("scale",{x:t.size,y:t.size,z:t.size}),e.setAttribute("fontSize",.1),e.setAttribute("visible",t.visible),e.object3D.renderOrder=t.renderOrder||this.renderOrderUI,this.containerUI.appendChild(e)},addGroupBtn:function(t){this.objects[t.id]=document.createElement("a-entity");var e=this.objects[t.id];e.padding=t.padding||[0,0,0,0],e.id=t.id,e.class="ar-ui",e.layout=t.layout,e.onclick=t.onclick,e.setAttribute("position",{x:0,y:0,z:1e3}),e.setAttribute("visible",t.visible),e.object3D.renderOrder=t.renderOrder||this.renderOrderUI;var i=document.createElement("a-entity");i.setAttribute("rounded",{width:.075,height:.015,radius:.003,opacity:.75}),i.setAttribute("position",{x:-.0375}),e.appendChild(i),this.addImageToGroup(e,{id:"icon-"+t.id,atlasId:t.icon,color:"#333333",width:.01,height:.01,position:[-.03,.0075,0]}),this.addTextToGroup(e,{id:"title-"+t.id,text:t.title,font:"FiraSans-Bold",align:"left",color:"#333333",position:[.0265,.0075,0],size:.1}),this.addTextToGroup(e,{id:"description-"+t.id,text:t.description,font:"FiraSans-Regular",align:"left",color:"#333333",position:[.0135,.003,0],size:.075}),this.addColliderToGroup(e,{id:"collider-"+t.id,width:.075,height:.015,position:[.0135,.003,0],size:.075}),this.setGroupActive(t.id,t.active),this.containerUI.appendChild(e)},addColliderToGroup:function(t,e){var i=document.createElement("a-entity");i.selectable=!0,i.id=e.id,i.setAttribute("geometry",{primitive:"plane",width:e.width,height:e.height}),i.setAttribute("material",{shader:"flat",transparent:!0,opacity:0,fog:!1,depthTest:!1,depthWrite:!1}),i.setAttribute("position",{y:.0075}),t.appendChild(i)},setGroupActive:function(t,e){var i=this.objects[t];i.children[0].setAttribute("visible",e),e?(i.children[1].setAttribute("material",{color:"#333333"}),i.children[2].setAttribute("text",{color:"#333333"}),i.children[3].setAttribute("text",{color:"#333333"})):(i.children[1].setAttribute("material",{color:"#ffffff"}),i.children[2].setAttribute("text",{color:"#ffffff"}),i.children[3].setAttribute("text",{color:"#ffffff"}))},addTextToGroup:function(t,e){var i=document.createElement("a-entity");i.id=e.id,i.setAttribute("text",{value:e.text,font:"assets/fonts/"+e.font+".json",align:e.align||"center",shader:"msdf",color:e.color||"#FFFFFF"}),i.setAttribute("position",{x:e.position[0],y:e.position[1],z:e.position[2]}),i.setAttribute("scale",{x:e.size,y:e.size,z:e.size}),t.appendChild(i)},addImageToGroup:function(t,e){var i=document.createElement("a-entity");i.id=e.id,i.atlasId=e.atlasId||e.id,i.setAttribute("geometry",{primitive:"plane",width:e.width,height:e.height}),i.setAttribute("material",{shader:"flat",transparent:!0,fog:!1,src:"#ar_ui",color:"#333333",repeat:{x:this.atlas.images[i.atlasId].w/this.atlas.total.w,y:this.atlas.images[i.atlasId].h/this.atlas.total.h},offset:{x:(this.atlas.total.w-this.atlas.images[i.atlasId].x)/this.atlas.total.w,y:this.atlas.images[i.atlasId].y/this.atlas.total.h}}),i.setAttribute("position",{x:e.position[0],y:e.position[1],z:e.position[2]}),t.appendChild(i)},animateEl:function(t,e){var i=t.objects[e];i&&(t.tweenSaving=new AFRAME.TWEEN.Tween(i.object3D.rotation).to({z:2*-Math.PI},1e3).onComplete(function(){i.object3D.rotation.z=0}).repeat(1/0).start())},moveAroundEl:function(t,e){var i=t.objects[e];if(i){var s=i.object3D.scale.x;t.tweenMoveAround1=new AFRAME.TWEEN.Tween({valueScale:s,valuePosY:0}).to({valueScale:1.5*s,valuePosY:-.1},600).easing(TWEEN.Easing.Quadratic.Out).onUpdate(function(){i.object3D.scale.x=this.valueScale,i.object3D.scale.y=this.valueScale,i.object3D.position.y=this.valuePosY}).onComplete(function(){this.valueScale=s,this.valuePosY=0}),t.tweenMoveAround2=new AFRAME.TWEEN.Tween({valueScale:1.5*s,valuePosX:0,valuePosY:-.1}).to({valueScale:s,valuePosX:-.25,valuePosY:0},1200).easing(TWEEN.Easing.Quadratic.InOut).onUpdate(function(){i.object3D.scale.x=this.valueScale,i.object3D.scale.y=this.valueScale,i.object3D.position.x=this.valuePosX,i.object3D.position.y=this.valuePosY}).onComplete(function(){this.valueScale=1.5*s,this.valuePosX=0,this.valuePosY=-.1}),t.tweenMoveAround3=new AFRAME.TWEEN.Tween({valuePosX:-.25}).to({valuePosX:.25},1800).easing(TWEEN.Easing.Quadratic.InOut).onUpdate(function(){i.object3D.position.x=this.valuePosX}).onComplete(function(){this.valuePosX=-.25}),t.tweenMoveAround4=new AFRAME.TWEEN.Tween({valueScale:s,valuePosX:.25,valuePosY:0}).to({valueScale:.5*s,valuePosX:0,valuePosY:.1},1200).easing(TWEEN.Easing.Quadratic.InOut).onUpdate(function(){i.object3D.scale.x=this.valueScale,i.object3D.scale.y=this.valueScale,i.object3D.position.x=this.valuePosX,i.object3D.position.y=this.valuePosY}).onComplete(function(){this.valueScale=s,this.valuePosX=.25,this.valuePosY=0}),t.tweenMoveAround5=new AFRAME.TWEEN.Tween({valueScale:.5*s,valuePosY:.1}).to({valueScale:s,valuePosY:0},600).easing(TWEEN.Easing.Quadratic.In).onUpdate(function(){i.object3D.scale.x=this.valueScale,i.object3D.scale.y=this.valueScale,i.object3D.position.y=this.valuePosY}).onComplete(function(){this.valueScale=.5*s,this.valuePosY=.1}),t.tweenMoveAround1.chain(t.tweenMoveAround2),t.tweenMoveAround2.chain(t.tweenMoveAround3),t.tweenMoveAround3.chain(t.tweenMoveAround4),t.tweenMoveAround4.chain(t.tweenMoveAround5),t.tweenMoveAround5.chain(t.tweenMoveAround1),t.tweenMoveAround1.start()}},stopMoveAround:function(){this.tweenMoveAround1.stop(),this.tweenMoveAround2.stop(),this.tweenMoveAround3.stop(),this.tweenMoveAround4.stop(),this.tweenMoveAround5.stop()},showEl:function(t,e,i,s){var n=t.objects[e];if(n){n.setAttribute("visible",!0),i&&n.setAttribute("enabled",!0);var o=1;n.getAttribute("fontSize")&&(o=n.getAttribute("fontSize")),setTimeout(function(){t.place(n),n.object3D.scale.set(.01*o,.01*o,.01*o),new AFRAME.TWEEN.Tween(n.object3D.scale).to({x:o*t.scaleFactor,y:o*t.scaleFactor,z:o*t.scaleFactor},290).delay(s||0).easing(AFRAME.TWEEN.Easing.Back.Out).start()},500)}},hideEl:function(t,e,i,s){var n=t.objects[e];n&&(i&&n.setAttribute("enabled",!1),new AFRAME.TWEEN.Tween(n.object3D.scale).to({x:.01,y:.01,z:.01},500).delay(s||0).easing(AFRAME.TWEEN.Easing.Back.In).onComplete(function(){n.setAttribute("visible",!1)}).start())},onmove:function(t){var e=this.el,i=t;t.touches&&(i=t.touches[0]),this.normalizedCoordinatedPositionPointer.x=i.clientX/this.el.sceneEl.canvas.clientWidth*2-1,this.normalizedCoordinatedPositionPointer.y=2*-(i.clientY/this.el.sceneEl.canvas.clientHeight)+1,this.raycaster.setFromCamera(this.normalizedCoordinatedPositionPointer,this.orthoCamera);var s=this.raycaster.intersectObjects(this.getIntersectedObjects(),!0);if(this.intersection=s.length>0?s[0]:null,this.tapped&&"strokeDragDot"===this.lastObjectOverId)return void this.dragStroke();var n=null;if(i===t)if(null!==this.intersection){if(e.sceneEl.canvas.style.cursor="pointer",n=this.intersection.object.el.id,this.lastObjectOverId=n,""===n)return void(n=this.intersection.object.name);this.objOver?this.objOver.el.id!==n&&(this.objOver=this.intersection.object):this.objOver=this.intersection.object}else e.sceneEl.canvas.style.cursor=null,this.objOver&&(this.objOver=null);else null!==this.intersection&&(""===this.intersection.object.el.id?this.onclickSettingsUI(this.intersection.object,this.intersection.uv):(n=this.intersection.object.el.id,this.lastObjectOverId=n))},getIntersectedObjects:function(){var t=this,e=[];return Object.keys(this.objects).forEach(function(i){"true"===t.objects[i].getAttribute("enabled")&&e.push(t.objects[i].object3D)}),"brushSettings"===this.modalOpened&&this.settingsUI.getAttribute("visible")&&e.push(this.settingsUI.object3D),e},tap:function(t){var e=(this.el,t);t.touches&&(e=t.touches[0]),this.UIHided&&this.showUI(),this.tapped=!0,this.normalizedCoordinatedPositionPointer.x=e.clientX/this.el.sceneEl.canvas.clientWidth*2-1,this.normalizedCoordinatedPositionPointer.y=2*-(e.clientY/this.el.sceneEl.canvas.clientHeight)+1,this.raycaster.setFromCamera(this.normalizedCoordinatedPositionPointer,this.orthoCamera);var i=this.raycaster.intersectObjects(this.getIntersectedObjects(),!0);this.intersection=null;var s=null;if(i.length>0){for(var n=0;n<i.length;n++)if(i[n].object.el.selectable){s=i[n];break}s?this.intersection=s:this.intersection=i[0]}null!==this.modalOpened?this.el.emit("objectsUIIntersected",{intersections:1}):this.el.emit("objectsUIIntersected",{intersections:i.length}),null!==this.intersection&&(""===this.intersection.object.el.id?this.onclickSettingsUI(this.intersection.object,this.intersection.uv):("strokeDragDot"!==this.intersection.object.el.id,this.intersection.object.el.id.indexOf("collider")!==-1?this.onclick(this.intersection.object.parent.parent.el.id):this.onclick(this.intersection.object.el.id))),this.lastObjectOverId=null},tapend:function(t){this.tapped=!1,this.lastObjectOverId=null,this.pressedObjects={}},onclick:function(t){this.objects[t]&&this.objects[t].onclick&&this.objects[t].onclick(this)},onWindowResize:function(t){this.width=window.innerWidth/window.innerHeight,this.height=1;var e=this;Object.keys(this.objects).forEach(function(t){e.objects[t].getAttribute("visible")&&e.place(e.objects[t],e.width,e.height)}),this.aspect=window.innerWidth/window.innerHeight,this.orthoCamera.left=-this.frustumSize*this.aspect/2,this.orthoCamera.right=this.frustumSize*this.aspect/2,this.orthoCamera.top=this.frustumSize/2,this.orthoCamera.bottom=-this.frustumSize/2,this.orthoCamera.updateProjectionMatrix()},place:function(t){var e=this.width,i=this.height;this.scaleFactor=window.devicePixelRatio*Math.max(1,e/i)*2,t.object3D.scale.set(this.scaleFactor,this.scaleFactor,this.scaleFactor);var s={x:0,y:0,z:this.depth};if(!t.object3D.width&&!t.object3D.height){var n=t.object3D.children[0].geometry;if(n&&n.layout)t.object3D.width=.001*n.layout.width,t.object3D.height=.001*n.layout.height;else{for(var o=null,r=0;r<t.object3D.children.length;r++)if(t.object3D.children[r].el.selectable){o=r;break}o?t.object3D.box3Obj=(new THREE.Box3).setFromObject(t.object3D.children[o]):t.object3D.box3Obj=(new THREE.Box3).setFromObject(t.object3D),t.object3D.width=(t.object3D.box3Obj.max.x-t.object3D.box3Obj.min.x)/this.scaleFactor,t.object3D.height=(t.object3D.box3Obj.max.y-t.object3D.box3Obj.min.y)/this.scaleFactor}}switch(t.layout){case"bottom-center":case"stroke-drag":s.y=-(i/2)+t.object3D.height/2*this.scaleFactor-this.paddingBottom*this.scaleFactor+t.padding[2]*this.scaleFactor;break;case"top-center":s.y=i/2-t.object3D.height/2*this.scaleFactor+this.paddingTop*this.scaleFactor-t.padding[0]*this.scaleFactor;break;case"top-right":s.x=e/2-t.object3D.width/2*this.scaleFactor+this.paddingRight*this.scaleFactor-t.padding[1]*this.scaleFactor,s.y=i/2-t.object3D.height/2*this.scaleFactor+this.paddingTop*this.scaleFactor-t.padding[0]*this.scaleFactor;break;case"top-left":s.x=-(e/2)+t.object3D.width/2*this.scaleFactor-this.paddingRight*this.scaleFactor+t.padding[1]*this.scaleFactor,s.y=i/2-t.object3D.height/2*this.scaleFactor+this.paddingTop*this.scaleFactor-t.padding[0]*this.scaleFactor;break;case"bottom-left":s.x=-(e/2)+t.object3D.width/2*this.scaleFactor-this.paddingRight*this.scaleFactor+t.padding[1]*this.scaleFactor,s.y=-(i/2)+t.object3D.height/2*this.scaleFactor-this.paddingBottom*this.scaleFactor+t.padding[2]*this.scaleFactor;break;case"bottom-right":s.x=e/2-t.object3D.width/2*this.scaleFactor+this.paddingRight*this.scaleFactor-t.padding[1]*this.scaleFactor,s.y=-(i/2)+t.object3D.height/2*this.scaleFactor-this.paddingBottom*this.scaleFactor+t.padding[2]*this.scaleFactor;break;case"fader":s={x:0,y:0,z:this.depth};var a=this.scaleFactor*this.width/this.height;t.object3D.scale.set(a,this.scaleFactor,this.scaleFactor);break;case"center":s.x=t.padding[3]*this.scaleFactor-t.padding[1]*this.scaleFactor,s.y=t.padding[2]*this.scaleFactor-t.padding[0]*this.scaleFactor;break;default:s={x:0,y:0,z:1e4}}"stroke-drag"===t.layout&&(s.x+=this.objects.strokeDragBar.object3D.width*this.scaleFactor*this.strokeNormalized-this.objects.strokeDragBar.object3D.width/2*this.scaleFactor),t.setAttribute("position",s)},enterPainterMode:function(){var t=this;document.querySelector("a-scene").addEventListener("poseLost",this.onPoseLost),document.querySelector("a-scene").addEventListener("poseFound",this.onPoseFound),this.showEl(this,"closeBtn",!0,200),this.showEl(this,"undoBtn",!0,500),this.showEl(this,"saveBtn",!0,800),this.showEl(this,"paintModeBtn",!0,1100),this.showEl(this,"hideUIBtn",!0,1400),this.showEl(this,"strokeDragBar",!1,1700),this.showEl(this,"strokeDragDot",!0,2200),this.showEl(this,"brushBtn",!0,2300),this.playSound("#uiClick0"),setTimeout(function(){t.el.emit("activate",!1)},2100)},exitPainterMode:function(){window.location.href="/#"},playSound:function(t){var e=document.querySelector(t);e&&(e.components.sound.stopSound(),e.components.sound.playSound())},openModal:function(t,e){var i=this;this.modalOpened=t;var s=document.querySelector("#fader-"+t);s.setAttribute("visible",!0),s.setAttribute("ar-ui-modal-material",{steps:{x:0,y:0,z:0,w:0},opacity:0}),new AFRAME.TWEEN.Tween({value:0}).to({value:.9},500).onUpdate(function(){s.setAttribute("ar-ui-modal-material",{opacity:this.value})}).start();var n={x:0,y:.1,z:.2,w:.3};switch(new AFRAME.TWEEN.Tween(n).to({x:0,y:.33,z:.66,w:1},500).onUpdate(function(){s.setAttribute("ar-ui-modal-material",{steps:this})}).onComplete(function(){i.objects.brushBtn.setAttribute("enabled",!0)}).start(),this.objects.closeBtn.setAttribute("enabled",!1),this.objects.saveBtn.setAttribute("enabled",!1),this.objects.undoBtn.setAttribute("enabled",!1),this.objects.hideUIBtn.setAttribute("enabled",!1),this.objects.brushBtn.setAttribute("enabled",!1),t){case"saving":this.showEl(this,"saving",!1,100),this.animateEl(this,"saving");break;case"trackingLost":this.showEl(this,"trackingLost",!1,100),this.showEl(this,"trackingDevice",!1,300);break;case"brushSettings":this.showEl(this,"closeSettingsBtn",!0,100),this.settingsUI.setAttribute("visible",!0);break;case"paintMode":this.showEl(this,"closePaintModeBtn",!0,100),this.showEl(this,"titlePaintModeModal",!1,200),this.showEl(this,"paintMode1",!0,300),this.showEl(this,"paintMode2",!0,400)}this.place(s)},closeModal:function(t,e){var i=this,s=document.querySelector("#fader-"+t);switch(this.objects.closeBtn.setAttribute("enabled",!0),this.objects.saveBtn.setAttribute("enabled",!0),this.objects.undoBtn.setAttribute("enabled",!0),this.objects.hideUIBtn.setAttribute("enabled",!0),this.objects.brushBtn.setAttribute("enabled",!1),t){case"saving":i.hideEl(i,"saving",!1),this.tweenSaving.stop();break;case"trackingLost":i.hideEl(i,"trackingDevice",!1),i.hideEl(i,"trackingLost",!1,100);break;case"brushSettings":this.hideEl(this,"closeSettingsBtn",!0),this.settingsUI.setAttribute("visible",!1);break;case"paintMode":this.hideEl(this,"closePaintModeBtn",!0),this.hideEl(this,"titlePaintModeModal",!1),this.hideEl(this,"paintMode1",!0),this.hideEl(this,"paintMode2",!0)}new AFRAME.TWEEN.Tween({value:.9}).to({value:0},500).delay(500).onUpdate(function(){s.setAttribute("ar-ui-modal-material",{opacity:this.value})}).start();var n={x:0,y:.33,z:.66,w:1};new AFRAME.TWEEN.Tween(n).to({x:0,y:.1,z:.2,w:.3},500).onUpdate(function(){s.setAttribute("ar-ui-modal-material",{steps:this})}).delay(500).onComplete(function(){i.modalOpened=null,s.setAttribute("visible",!1),i.objects.brushBtn.setAttribute("enabled",!0)}).start()},undo:function(){console.log("undo",this),this.el.sceneEl.systems.brush.undo(),this.playSound("#uiUndo")},save:function(){this.el.sceneEl.systems.painter.upload(),this.openModal("saving",this.saved)},saved:function(t){this.tweenSaving.stop(),this.showEl(this,"saved",!1,10),setTimeout(function(){window.location.href="/?url="+t+"#save-painting"},1e3)},dragStroke:function(){var t=(this.width-this.width/2)*this.normalizedCoordinatedPositionPointer.x,e=t-this.objects.strokeDragBar.object3D.position.x,i=THREE.Math.mapLinear(e,-this.objects.strokeDragBar.object3D.width/2*this.scaleFactor,this.objects.strokeDragBar.object3D.width/2*this.scaleFactor,0,1),s=THREE.Math.clamp(i,0,1);this.strokeNormalized=s,this.placeStrokeDragDot()},placeStrokeDragDot:function(){this.place(this.objects.strokeDragDot);var t=THREE.Math.mapLinear(this.strokeNormalized,0,1,.2,1.5);this.strokeOnButton.setAttribute("scale",new THREE.Vector3(t,t,t));var e=this.el.components.brush.schema.size,i=e.default;i=this.strokeNormalized>.5?THREE.Math.mapLinear(this.strokeNormalized,.5,1,e.default,e.max):THREE.Math.mapLinear(this.strokeNormalized,.5,0,e.default,e.min),this.el.setAttribute("brush","size",i),this.onBrushChanged()},setStrokeBar:function(t){var e=this.el.components.brush.schema.size;t>e.default?this.strokeNormalized=THREE.Math.mapLinear(t,e.default,e.max,.5,1):this.strokeNormalized=THREE.Math.mapLinear(t,e.default,e.min,.5,0);var i=THREE.Math.mapLinear(this.strokeNormalized,0,1,.2,1.5);this.strokeOnButton.setAttribute("scale",new THREE.Vector3(i,i,i))},onPoseLost:function(){null===this.modalOpened&&this.openModal("trackingLost")},onPoseFound:function(){null!==this.modalOpened&&this.closeModal("trackingLost")},openBrushSettings:function(){document.querySelector("a-scene").removeEventListener("poseLost",this.onPoseLost),document.querySelector("a-scene").removeEventListener("poseFound",this.onPoseFound),null===this.modalOpened&&(this.openModal("brushSettings"),this.playSound("#uiClick0"))},closeBrushSettings:function(){document.querySelector("a-scene").addEventListener("poseLost",this.onPoseLost),document.querySelector("a-scene").addEventListener("poseFound",this.onPoseFound),null!==this.modalOpened&&(this.closeModal("brushSettings"),this.playSound("#uiClick1"))},openPaintMode:function(){document.querySelector("a-scene").removeEventListener("poseLost",this.onPoseLost),document.querySelector("a-scene").removeEventListener("poseFound",this.onPoseFound),null===this.modalOpened&&(this.openModal("paintMode"),this.playSound("#uiClick0"))},hideUI:function(){this.UIHided=!0,document.querySelector("a-scene").removeEventListener("poseLost",this.onPoseLost),document.querySelector("a-scene").removeEventListener("poseFound",this.onPoseFound),this.objects.closeBtn.setAttribute("visible",!1),this.objects.undoBtn.setAttribute("visible",!1),this.objects.saveBtn.setAttribute("visible",!1),this.objects.paintModeBtn.setAttribute("visible",!1),this.objects.hideUIBtn.setAttribute("visible",!1),this.objects.strokeDragBar.setAttribute("visible",!1),this.objects.strokeDragDot.setAttribute("visible",!1),this.objects.brushBtn.setAttribute("visible",!1),this.showEl(this,"showUIAlert",!1,50);var t=this;this.showUIAlertTimeOut=setTimeout(function(){t.hideEl(t,"showUIAlert",!1)},2e3)},showUI:function(){this.UIHided=!1,clearTimeout(this.showUIAlertTimeOut),document.querySelector("a-scene").addEventListener("poseLost",this.onPoseLost),document.querySelector("a-scene").addEventListener("poseFound",this.onPoseFound),this.hideEl(this,"showUIAlert",!1),this.objects.closeBtn.setAttribute("visible",!0),this.objects.undoBtn.setAttribute("visible",!0),this.objects.saveBtn.setAttribute("visible",!0),this.objects.paintModeBtn.setAttribute("visible",!0),this.objects.hideUIBtn.setAttribute("visible",!0),this.objects.strokeDragBar.setAttribute("visible",!0),this.objects.strokeDragDot.setAttribute("visible",!0),this.objects.brushBtn.setAttribute("visible",!0)},closePaintMode:function(){document.querySelector("a-scene").addEventListener("poseLost",this.onPoseLost),document.querySelector("a-scene").addEventListener("poseFound",this.onPoseFound),null!==this.modalOpened&&(this.closeModal("paintMode"),this.playSound("#uiClick1"))},brushBtnClicked:function(){this.modalOpened?this.closeBrushSettings():this.openBrushSettings();
},changePaintMode:function(t){if(t!==this.paintMode){this.setGroupActive("paintMode"+this.paintMode,!1),this.setGroupActive("paintMode"+t,!0),this.paintMode=t,this.playSound("#uiClick0");var e="paintMode"+this.paintMode+"Btn",i=this.objects.paintModeBtn.object3D.children[0].material;i.map.offset.x=(this.atlas.total.w-this.atlas.images[e].x)/this.atlas.total.w,i.map.offset.y=this.atlas.images[e].y/this.atlas.total.h;var s="normal";switch(this.paintMode){case 2:s="advanced"}this.paintControlsEl.setAttribute("ar-paint-controls","mode",s),this.closeModal("paintMode")}}})},function(t,e){var i="\tvarying vec2 vUv;\tvoid main() {\t  vUv = uv;\t  vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\t  gl_Position = projectionMatrix * mvPosition;\t}\t",s="\t  varying vec2 vUv;\t  uniform vec4 steps;\t  uniform float opacity;\t  \t  void main() {\t    vec4 purple = vec4(0.34, 0.33, 0.6, 1.0);\t    vec4 red2 = vec4(0.85, 0.23, 0.45, 1.0);\t    vec4 red = vec4(0.88, 0.35, 0.36, 1.0);\t    vec4 orange = vec4(0.93, 0.56, 0.2, 1.0);\t    float step1 = steps.x;\t    float step2 = steps.y;\t    float step3 = steps.z;\t    float step4 = steps.w;\t    \t    vec4 color = mix(purple, red2, smoothstep(step1, step2, vUv.y));\t    color = mix(color, red, smoothstep(step2, step3, vUv.y));\t    color = mix(color, orange, smoothstep(step3, step4, vUv.y));\t    \t    gl_FragColor = vec4(color.xyz, opacity);\t  }\t// ";AFRAME.registerComponent("ar-ui-modal-material",{schema:{steps:{type:"vec4"},opacity:{type:"number"}},init:function(){this.material=new THREE.ShaderMaterial({uniforms:{steps:{value:this.data.steps},opacity:{value:this.data.opacity}},transparent:!0,vertexShader:i,fragmentShader:s}),this.applyToMesh()},update:function(){this.material.uniforms.steps.value=this.data.steps,this.material.uniforms.opacity.value=this.data.opacity},applyToMesh:function(){const t=this.el.getObject3D("mesh");t&&(t.material=this.material)},tick:function(t){}})},function(t,e){AFRAME.registerComponent("brush",{schema:{color:{type:"color",default:"#ef2d5e"},size:{default:.01,min:.001,max:.3},brush:{default:"flat"},enabled:{default:!0}},init:function(){var t=this.data;this.color=new THREE.Color(t.color),this.el.emit("brushcolor-changed",{color:this.color}),this.el.emit("brushsize-changed",{brushSize:t.size}),this.active=!1,this.obj=this.el.object3D,this.currentStroke=null,this.strokeEntities=[],this.sizeModifier=0,this.textures={},this.currentMap=0,this.model=this.el.getObject3D("mesh"),this.drawing=!1;var e=this;this.previousAxis=0,this.el.addEventListener("undo",function(t){e.data.enabled&&e.system.undo()}),this.el.addEventListener("paint",function(t){if(e.data.enabled){var i=t.detail.value;e.sizeModifier=i,i>.1?e.active||(e.startNewStroke(),e.active=!0):(e.active&&(e.previousEntity=e.currentEntity,e.currentStroke=null),e.active=!1)}})},update:function(t){var e=this.data;t.color!==e.color&&(this.color.set(e.color),this.el.emit("brushcolor-changed",{color:this.color})),t.size!==e.size&&this.el.emit("brushsize-changed",{size:e.size})},tick:function(){var t=new THREE.Vector3,e=new THREE.Quaternion,i=new THREE.Vector3;return function(s,n){if(this.currentStroke&&this.active){this.obj.matrixWorld.decompose(t,e,i);var o=this.system.getPointerPosition(t,e);this.currentStroke.addPoint(t,e,o,this.sizeModifier,s)}}}(),startNewStroke:function(){this.currentStroke=this.system.addNewStroke(this.data.brush,this.color,this.data.size),this.el.emit("stroke-started",{entity:this.el,stroke:this.currentStroke})}})},function(t,e){var i=AFRAME.utils;AFRAME.registerComponent("if-no-vr-headset",{schema:{default:{},parse:i.styleParser.parse},update:function(){var t=this;return this.el.sceneEl.isMobile?void this.setProperties():void navigator.getVRDisplays().then(function(e){e.length&&"Emulated HTC Vive DVT"!==e[0].displayName||t.setProperties()})},setProperties:function(){var t=this.data,e=this.el;Object.keys(t).forEach(function(i){e.setAttribute(i,t[i])})}})},function(t,e){AFRAME.registerComponent("json-model",{schema:{src:{type:"asset"}},init:function(){this.objectLoader=new THREE.ObjectLoader,this.objectLoader.setCrossOrigin("")},update:function(t){var e=this,i=this.data.src;i&&i!==t.src&&this.objectLoader.load(this.data.src,function(t){var s=(new THREE.Matrix4).makeRotationX(-Math.PI/2);t.traverse(function(t){t instanceof THREE.Mesh&&t.position.applyMatrix4(s)}),e.el.setObject3D("mesh",t),e.el.emit("model-loaded",{format:"json",model:t,src:i})})}})},function(t,e){AFRAME.registerComponent("orbit-controls",{dependencies:["camera"],schema:{position:{default:"0 1.6 0.1",type:"vec3"}},init:function(){var t=this.el.sceneEl,e=this.setupControls.bind(this);this.el.sceneEl.is("vr-mode")||this.el.setAttribute("position",this.data.position),t.canvas?e():t.addEventListener("render-target-loaded",e),this.onEnterVR=this.onEnterVR.bind(this),this.onExitVR=this.onExitVR.bind(this),t.addEventListener("enter-vr",this.onEnterVR),t.addEventListener("exit-vr",this.onExitVR)},onExitVR:function(){this.el.setAttribute("position",this.data.position),this.controls.enabled=!0},onEnterVR:function(){if(AFRAME.utils.device.checkHeadsetConnected()||this.el.sceneEl.isMobile){var t=this.el.getAttribute("position"),e=this.el.getObject3D("camera");this.controls.enabled=!1,e.position.set(0,0,0),e.rotation.set(0,0,0),this.el.sceneEl.isMobile||this.el.setAttribute("position",{x:t.x-this.data.position.x,y:t.y-this.data.position.y,z:t.z-this.data.position.z})}},setupControls:function(){var t=this.el.sceneEl.renderer,e=this.el.getObject3D("camera"),i=this.controls=new THREE.OrbitControls(e,t.domElement),s=this.el.getAttribute("position");i.target.setX(-s.x),i.target.setZ(-s.z),i.enableDamping=!0,i.dampingFactor=1,i.enableZoom=!0},play:function(){this.controls&&(this.controls.enabled=!0)},pause:function(){this.controls&&(this.controls.enabled=!1)},remove:function(){this.pause()}})},function(t,e){AFRAME.registerSystem("paint-controls",{numberStrokes:0}),AFRAME.registerComponent("paint-controls",{dependencies:["brush"],schema:{hand:{default:"left"}},init:function(){function t(t){var e=i.highLightMaterial=new THREE.MeshBasicMaterial;e.map=t,e.needsUpdate=!0}var e=this.el,i=this,s="assets/images/controller-pressed.png",n=null;this.controller=null,this.modelLoaded=!1,this.onModelLoaded=this.onModelLoaded.bind(this),e.addEventListener("model-loaded",this.onModelLoaded),e.addEventListener("changeBrushSizeAbs",function(t){if((0!==t.detail.axis[0]||0!==t.detail.axis[1])&&i.previousAxis!==t.detail.axis[1]){var s=t.detail.axis[1]/300,n=e.components.brush.schema.size,o=THREE.Math.clamp(i.el.getAttribute("brush").size-s,n.min,n.max);i.el.setAttribute("brush","size",o)}}),e.addEventListener("changeBrushSizeInc",function(t){if((0!==t.detail.axis[0]||0!==t.detail.axis[1])&&i.previousAxis!==t.detail.axis[1]){i.touchStarted&&(i.touchStarted=!1,i.startAxis=(t.detail.axis[1]+1)/2);var s=(t.detail.axis[1]+1)/2,n=(i.startAxis-s)/2;i.startAxis=s;var o=i.el.getAttribute("brush").size,r=e.components.brush.schema.size,a=THREE.Math.clamp(o-n,r.min,r.max);i.el.setAttribute("brush","size",a)}}),i.touchStarted=!1,e.addEventListener("startChangeBrushSize",function(){i.touchStarted=!0}),e.addEventListener("controllerconnected",function(t){var i=t.detail.name;if(n=Utils.getTooltips(i),"windows-motion-controls"===i);else if("oculus-touch-controls"===i){var s=t.detail.component.data.hand;e.setAttribute("obj-model",{obj:"assets/models/oculus-"+s+"-controller.obj",mtl:"https://cdn.aframe.io/controllers/oculus/oculus-touch-controller-"+s+".mtl"})}else{if("vive-controls"!==i)return;e.setAttribute("json-model",{src:"assets/models/controller_vive.json"})}n&&n.forEach(function(t){t.setAttribute("visible",!0)}),this.controller=i}),e.addEventListener("brushsize-changed",function(t){i.changeBrushSize(t.detail.size)}),e.addEventListener("brushcolor-changed",function(t){i.changeBrushColor(t.detail.color)}),e.sceneEl.systems.material.loadTexture(s,{src:s},t),this.startAxis=0,this.numberStrokes=0,document.addEventListener("stroke-started",function(t){if(t.detail.entity.components["paint-controls"]===i&&(i.numberStrokes++,i.system.numberStrokes++,3===i.system.numberStrokes)){var e=Array.prototype.slice.call(document.querySelectorAll("[tooltip]")),s={opacity:1},n=new AFRAME.TWEEN.Tween(s).to({opacity:0},1e3).onComplete(function(){e.forEach(function(t){t.setAttribute("visible",!1)})}).delay(2e3).onUpdate(function(){e.forEach(function(t){t.setAttribute("tooltip",{opacity:s.opacity})})});n.start()}})},changeBrushColor:function(t){this.modelLoaded&&this.buttonMeshes.sizeHint&&(this.buttonMeshes.colorTip.material.color.copy(t),this.buttonMeshes.sizeHint.material.color.copy(t))},changeBrushSize:function(t){var e=t/2*10;this.modelLoaded&&this.buttonMeshes.sizeHint&&this.buttonMeshes.sizeHint.scale.set(e,e,1)},mapping:{axis0:"trackpad",axis1:"trackpad",button0:"trackpad",button1:"trigger",button2:"grip",button3:"menu",button4:"system"},update:function(){var t=this.data,e=this.el;e.setAttribute("vive-controls",{hand:t.hand,model:!1}),e.setAttribute("oculus-touch-controls",{hand:t.hand,model:!1}),e.setAttribute("windows-motion-controls",{hand:t.hand})},play:function(){},pause:function(){},onModelLoaded:function(t){var e,i=t.detail.model;t.detail.target===this.el&&(e=this.buttonMeshes={},e.sizeHint=i.getObjectByName("sizehint"),e.colorTip=i.getObjectByName("tip"),this.modelLoaded=!0,this.changeBrushSize(this.el.components.brush.data.size),this.changeBrushColor(this.el.components.brush.color))},onButtonEvent:function(t,e){var i=this.mapping["button"+t];this.el.emit(i+e),this.updateModel(i,e)},updateModel:function(t,e){var i="up"===e?this.material:this.highLightMaterial,s=this.buttonMeshes,n=s&&s[t];if("down"===e&&n&&!this.material&&(i=this.material=n.material),i)return"grip"===t?(s.grip.left.material=i,void(s.grip.right.material=i)):void(n&&(n.material=i))}})},function(t,e){AFRAME.registerComponent("ui",{schema:{brightness:{default:1,max:1,min:0}},dependencies:["ui-raycaster"],init:function(){var t=this.el,e=this.uiEl=document.createElement("a-entity"),i=this.rayEl=document.createElement("a-entity");this.closed=!0,this.isTooltipPaused=!1,this.colorStack=["#272727","#727272","#FFFFFF","#24CAFF","#249F90","#F2E646","#EF2D5E"],this.bindMethods(),this.colorHasChanged=!0,this.highlightMaterials={},this.intersectedObjects=[],this.hoveredOffObjects=[],this.hoveredOnObjects=[],this.pressedObjects={},this.selectedObjects={},this.unpressedObjects={},this.brushButtonsMapping={},this.brushRegexp=/^(?!.*(fg|bg)$)brush[0-9]+/,this.colorHistoryRegexp=/^(?!.*(fg|bg)$)colorhistory[0-9]+$/,this.hsv={h:0,s:0,v:1},this.rayAngle=45,this.rayDistance=.2,this.cursorOffset=new THREE.Vector3(.06409,.01419,-.10242),e.setAttribute("material",{color:"#ffffff",flatShading:!0,shader:"flat",transparent:!0,fog:!1,src:"#uinormal"}),e.setAttribute("obj-model","obj:#uiobj"),e.setAttribute("position","0 0.04 -0.15"),e.setAttribute("scale","0 0 0"),e.setAttribute("visible",!1),e.classList.add("apainter-ui"),t.appendChild(e),i.setAttribute("line",""),t.appendChild(i),t.setAttribute("ui-raycaster",{far:this.rayDistance,objects:".apainter-ui",rotation:-this.rayAngle}),this.controller=null;var s=this;t.addEventListener("controllerconnected",function(i){var n=i.detail.name;s.tooltips=Utils.getTooltips(n),s.controller={name:n,hand:i.detail.component.data.hand},"oculus-touch-controls"===n?(s.uiEl.setAttribute("rotation","45 0 0"),e.setAttribute("position","0 0.13 -0.08"),s.rayAngle=0,t.setAttribute("ui-raycaster",{rotation:0})):"windows-motion-controls"===n&&(s.rayAngle=25,s.rayDistance=1,t.setAttribute("ui-raycaster",{rotation:-30,far:s.rayDistance})),s.el.isPlaying&&s.addToggleEvent()})},initColorWheel:function(){var t=this.objects.hueWheel,e="\t      varying vec2 vUv;\t      void main() {\t        vUv = uv;\t        vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\t        gl_Position = projectionMatrix * mvPosition;\t      }\t      ",i="\t      #define M_PI2 6.28318530718\n \t      uniform float brightness;\t      varying vec2 vUv;\t      vec3 hsb2rgb(in vec3 c){\t          vec3 rgb = clamp(abs(mod(c.x * 6.0 + vec3(0.0, 4.0, 2.0), 6.0) - 3.0) - 1.0, \t                           0.0, \t                           1.0 );\t          rgb = rgb * rgb * (3.0 - 2.0 * rgb);\t          return c.z * mix( vec3(1.0), rgb, c.y);\t      }\t      \t      void main() {\t        vec2 toCenter = vec2(0.5) - vUv;\t        float angle = atan(toCenter.y, toCenter.x);\t        float radius = length(toCenter) * 2.0;\t        vec3 color = hsb2rgb(vec3((angle / M_PI2) + 0.5, radius, brightness));\t        gl_FragColor = vec4(color, 1.0);\t      }\t      ",s=new THREE.ShaderMaterial({uniforms:{brightness:{type:"f",value:this.hsv.v}},vertexShader:e,fragmentShader:i});t.material=s},bindMethods:function(){this.onComponentChanged=this.onComponentChanged.bind(this),this.onTriggerChanged=this.onTriggerChanged.bind(this),this.onIntersection=this.onIntersection.bind(this),this.onIntersected=this.onIntersected.bind(this),this.onIntersectionCleared=this.onIntersectionCleared.bind(this),this.onIntersectedCleared=this.onIntersectedCleared.bind(this),this.onModelLoaded=this.onModelLoaded.bind(this),this.onStrokeStarted=this.onStrokeStarted.bind(this),this.toggleMenu=this.toggleMenu.bind(this)},tick:function(){this.el.components["ui-raycaster"].refreshObjects(),!this.closed&&this.handEl&&(this.updateIntersections(),this.handleHover(),this.handlePressedButtons())},onTriggerChanged:function(t){var e=t.detail.value;this.lastTriggerValue=e,t.detail.value>=.25?this.triggeredPressed=!0:(this.triggeredPressed=!1,this.handleButtonUp())},handleButtonDown:function(t,e){var i=t.name;if(!this.activeWidget||this.activeWidget===i){switch(this.activeWidget=i,!0){case"brightness"===i:this.onBrightnessDown(e);break;case"brushnext"===i:this.pressedObjects[i]||this.nextPage();break;case"brushprev"===i:this.pressedObjects[i]||this.previousPage();break;case"clear"===i:this.pressedObjects[i]||this.el.sceneEl.systems.brush.clear();break;case"copy"===i:this.pressedObjects[i]||this.copyBrush();break;case"hue"===i:this.onHueDown(e);break;case"save"===i:this.pressedObjects[i]||this.el.sceneEl.systems.painter.upload();break;case"sizebg"===i:this.onBrushSizeBackgroundDown(e);break;case this.brushRegexp.test(i):this.onBrushDown(i);break;case this.colorHistoryRegexp.test(i):this.onColorHistoryButtonDown(t);break;default:this.activeWidget=void 0}this.pressedObjects[i]=t}},copyBrush:function(){var t=this.el.getAttribute("brush");this.handEl.setAttribute("brush","brush",t.brush),this.handEl.setAttribute("brush","color",t.color),this.handEl.setAttribute("brush","size",t.size),this.colorHasChanged=!0},handleButtonUp:function(){var t=this.pressedObjects,e=this.unpressedObjects;this.activeWidget=void 0,Object.keys(t).forEach(function(i){var s=t[i].name;switch(!0){case"size"===s:}e[s]=t[s],delete t[s]})},handlePressedButtons:function(){var t=this;this.triggeredPressed&&this.hoveredOnObjects.forEach(function(e){t.handleButtonDown(e.object,e.point)})},onColorHistoryButtonDown:function(t){var e=t.material.color.getHexString();this.handEl.setAttribute("brush","color","#"+e)},onBrushDown:function(t){var e=this.brushButtonsMapping[t];e&&(this.selectBrushButton(t),this.handEl.setAttribute("brush","brush",e.toLowerCase()))},selectBrushButton:function(t){var e=this.uiEl.getObject3D("mesh").getObjectByName(t+"bg"),i=this.selectedObjects,s=this.selectedBrush;s&&(this.highlightMaterials[s.name]||this.initHighlightMaterial(e),s.material=this.highlightMaterials[s.name].normal,delete i[s.name]),i[e.name]=e,this.selectedBrush=e},onHueDown:function(t){var e,i=this.objects.hueWheel,s=this.colorWheelSize;i.updateMatrixWorld(),i.worldToLocal(t),this.objects.hueCursor.position.copy(t),e={r:Math.sqrt(t.x*t.x+t.z*t.z),theta:Math.PI+Math.atan2(-t.z,t.x)};var n=(e.theta*(180/Math.PI)+180)%360;this.hsv.h=n/360,this.hsv.s=e.r/s,this.updateColor()},updateColor:function(){var t=this.hsv2rgb(this.hsv),e="rgb("+t.r+", "+t.g+", "+t.b+")";this.handEl.setAttribute("brush","color",e),this.colorHasChanged=!0},hsv2rgb:function(t){var e,i,s,n,o,r,a,h,c=THREE.Math.clamp(t.h,0,1),d=THREE.Math.clamp(t.s,0,1),l=t.v;switch(n=Math.floor(6*c),o=6*c-n,r=l*(1-d),a=l*(1-o*d),h=l*(1-(1-o)*d),n%6){case 0:e=l,i=h,s=r;break;case 1:e=a,i=l,s=r;break;case 2:e=r,i=l,s=h;break;case 3:e=r,i=a,s=l;break;case 4:e=h,i=r,s=l;break;case 5:e=l,i=r,s=a}return{r:Math.round(255*e),g:Math.round(255*i),b:Math.round(255*s)}},rgb2hsv:function(t,e,i){var s,n=Math.max(t,e,i),o=Math.min(t,e,i),r=n-o,a=0===n?0:r/n,h=n;switch(1===arguments.length&&(e=t.g,i=t.b,t=t.r),n){case o:s=0;break;case t:s=e-i+r*(e<i?6:0),s/=6*r;break;case e:s=i-t+2*r,s/=6*r;break;case i:s=t-e+4*r,s/=6*r}return{h:s,s:a,v:h}},onBrightnessDown:function(t){var e=this.objects.brightnessSlider,i=e.geometry.boundingBox,s=i.max.z-i.min.z;e.updateMatrixWorld(),e.worldToLocal(t);var n=1-(t.z-i.min.z)/s;n=THREE.Math.clamp(1.29*n-.12,0,1),this.objects.hueWheel.material.uniforms.brightness.value=n,this.objects.brightnessCursor.rotation.y=1.5*n-1.5,this.hsv.v=n,this.updateColor()},onBrushSizeBackgroundDown:function(t){var e=this.objects.sizeSlider,i=e.geometry.boundingBox,s=i.max.x-i.min.x;e.updateMatrixWorld(),e.worldToLocal(t);var n=(t.x-i.min.x)/s;n*=AFRAME.components.brush.schema.size.max,this.handEl.setAttribute("brush","size",n)},handleHover:function(){this.updateHoverObjects(),this.updateMaterials()},updateHoverObjects:function(){var t=this.intersectedObjects;t=t.filter(function(t){return"bb"!==t.object.name&&"msg_save"!==t.object.name}),this.hoveredOffObjects=this.hoveredOnObjects.filter(function(e){return t.indexOf(e)===-1}),this.hoveredOnObjects=t},updateMaterials:function(){var t=new THREE.Vector3;return function(){var e=this,i=this.pressedObjects,s=this.unpressedObjects,n=this.selectedObjects;this.hoveredOffObjects.forEach(function(t){var i=t.object;i.material=e.highlightMaterials[i.name].normal}),this.hoveredOnObjects.forEach(function(i){var s=i.object;t.copy(i.point),e.highlightMaterials[s.name]||e.initHighlightMaterial(s),e.handRayEl.object3D.worldToLocal(t),e.handRayEl.setAttribute("line","end",t),s.material=e.highlightMaterials[s.name].hover}),Object.keys(i).forEach(function(t){var s=i[t],n=e.highlightMaterials[s.name];s.material=n.pressed||s.material}),Object.keys(s).forEach(function(t){var i=s[t],n=e.highlightMaterials[i.name];i.material=n.normal,delete s[t]}),Object.keys(n).forEach(function(t){var i=n[t],s=e.highlightMaterials[i.name];s&&(i.material=s.selected)})}}(),addToggleEvent:function(){this.el.addEventListener("toggleMenu",this.toggleMenu)},removeToggleEvent:function(){this.el.removeEventListener("toggleMenu",this.toggleMenu)},play:function(){var t=this.el,e=this.handEl;this.controller&&this.addToggleEvent(),t.addEventListener("model-loaded",this.onModelLoaded),t.addEventListener("raycaster-intersection",this.onIntersection),t.addEventListener("raycaster-intersection-cleared",this.onIntersectionCleared),t.addEventListener("raycaster-intersected",this.onIntersected),t.addEventListener("raycaster-intersected-cleared",this.onIntersectedCleared),e&&this.addHandListeners()},pause:function(){var t=this.el,e=this.handEl;this.controller&&this.removeToggleEvent(),t.removeEventListener("raycaster-intersection",this.onIntersection),t.removeEventListener("raycaster-intersection-cleared",this.onIntersectionCleared),t.removeEventListener("raycaster-intersected",this.onIntersected),t.removeEventListener("raycaster-intersected-cleared",this.onIntersectedCleared),e&&this.removeHandListeners()},onModelLoaded:function(t){function e(t){t.visible=!0;var e={opacity:0},i=new AFRAME.TWEEN.Tween(e).to({opacity:1},500).onUpdate(function(){o.messagesMaterial.opacity=e.opacity}).chain(new AFRAME.TWEEN.Tween(e).to({opacity:0},500).delay(3e3).onComplete(function(){t.visible=!1}).onUpdate(function(){o.messagesMaterial.opacity=e.opacity}));i.start()}var i=this.uiEl,s=i.getObject3D("mesh");if(s=t.detail.model,"obj"===t.detail.format&&s.getObjectByName("brightnesscursor")){this.objects={},this.objects.brightnessCursor=s.getObjectByName("brightnesscursor"),this.objects.brightnessSlider=s.getObjectByName("brightness"),this.objects.brightnessSlider.geometry.computeBoundingBox(),this.objects.previousPage=s.getObjectByName("brushprev"),this.objects.nextPage=s.getObjectByName("brushnext"),this.objects.hueCursor=s.getObjectByName("huecursor"),this.objects.hueWheel=s.getObjectByName("hue"),this.objects.hueWheel.geometry.computeBoundingSphere(),this.colorWheelSize=this.objects.hueWheel.geometry.boundingSphere.radius,this.objects.sizeCursor=s.getObjectByName("size"),this.objects.sizeCursor.position.copy(this.cursorOffset),this.objects.colorHistory=[];for(var n=0;n<7;n++)this.objects.colorHistory[n]=s.getObjectByName("colorhistory"+n);this.objects.currentColor=s.getObjectByName("currentcolor"),this.objects.sizeSlider=s.getObjectByName("sizebg"),this.objects.sizeSlider.geometry.computeBoundingBox(),s.getObjectByName("bb").material=new THREE.MeshBasicMaterial({color:2395940,alphaTest:0,visible:!1});var o=this;this.messagesMaterial=new THREE.MeshBasicMaterial({map:null,transparent:!0,opacity:0}),this.objects.messageSave=s.getObjectByName("msg_save"),this.objects.messageSave.material=this.messagesMaterial,this.objects.messageSave.visible=!1,this.objects.messageError=s.getObjectByName("msg_error"),this.objects.messageError.visible=!1,this.objects.messageError.material=this.messagesMaterial;var r="assets/images/messages.png";this.el.sceneEl.systems.material.loadTexture(r,{src:r},function(t){var e=o.messagesMaterial;e.map=t,e.needsUpdate=!0}),this.el.sceneEl.addEventListener("drawing-upload-completed",function(t){e(o.objects.messageSave)}),this.el.sceneEl.addEventListener("drawing-upload-error",function(t){e(o.objects.messageError)}),this.initColorWheel(),this.initColorHistory(),this.initBrushesMenu(),this.setCursorTransparency(),this.updateColorUI(this.el.getAttribute("brush").color),this.updateSizeSlider(this.el.getAttribute("brush").size)}},initBrushesMenu:function(){var t=this.objects.previousPage,e=this.objects.nextPage,i=Object.keys(AFRAME.BRUSHES);this.initHighlightMaterial(e),this.initHighlightMaterial(t),t.visible=!1,e.visible=!1,this.brushesPerPage=15,this.brushesPagesNum=Math.ceil(i.length/this.brushesPerPage),this.brushesPage=0,this.loadBrushes(this.brushesPage,this.brushesPerPage)},setCursorTransparency:function(){var t=this.objects.hueCursor,e=this.objects.brightnessCursor,i=this.objects.sizeCursor;i.material.alphaTest=.5,t.material.alphaTest=.5,e.material.alphaTest=.5,i.material.transparent=!0,t.material.transparent=!0,e.material.transparent=!0},loadBrushes:function(){var t={};return function(e,i){function s(e,i,s){function o(t){var e=d.getObjectByName("brush"+i);u.brushButtonsMapping["brush"+i]=r,n(t,e)}var r=e?(e.charAt(0).toUpperCase()+e.slice(1)).toLowerCase():void 0;return s&&!t[r]?void u.el.sceneEl.systems.material.loadTexture(s,{src:s},o):void o()}function n(e,i){var s=u.brushButtonsMapping[i.name],n=t[s]||new THREE.MeshBasicMaterial;e?(n.map=e,n.alphaTest=.5,n.transparent=!0):t[s]||(n.visible=!1),t[s]=n,u.highlightMaterials[i.name]={normal:n,hover:n,pressed:n,selected:n},i.material=n}var o,r,a,h,c=0,d=this.uiEl.getObject3D("mesh"),l=Object.keys(AFRAME.BRUSHES),u=this;if(!(e<0||e>=this.brushesPagesNum))for(0===e?this.objects.previousPage.visible=!1:this.objects.previousPage.visible=!0,e===this.brushesPagesNum-1?this.objects.nextPage.visible=!1:this.objects.nextPage.visible=!0,h=0;h<i;h++)a=e*i+h,o=l[a],r=o&&AFRAME.BRUSHES[o].prototype.options.thumbnail,s(o,c,r),c+=1}}(),nextPage:function(){this.brushesPage>=this.brushesPagesNum-1||(this.brushesPage++,this.loadBrushes(this.brushesPage,this.brushesPerPage))},previousPage:function(){0!==this.brushesPage&&(this.brushesPage--,this.loadBrushes(this.brushesPage,this.brushesPerPage))},initHighlightMaterial:function(t){var e=t.name,i=this.brushRegexp.test(e),s=e.indexOf("history")!==-1,n="hue"===e||"huecursor"===e,o={normal:t.material,hover:t.material,pressed:t.material,selected:t.material};i||s||n||(o.normal=t.material,o.hover=t.material.clone(),o.hover.map=this.system.hoverTexture,o.selected=t.material.clone(),o.selected.map=this.system.pressedTexture,o.pressed=t.material.clone(),o.pressed.map=this.system.pressedTexture),this.highlightMaterials[e]=o},toggleMenu:function(t){this.closed?(this.system.closeAll(),this.open(),this.system.opened=this.el):(this.close(),this.system.opened=void 0)},open:function(){var t,e=this.uiEl,i={x:0,y:0,z:0};if(this.closed&&(this.uiEl.setAttribute("visible",!0),t=new AFRAME.TWEEN.Tween(i).to({x:1,y:1,z:1},100).onUpdate(function(){e.setAttribute("scale",this)}).easing(AFRAME.TWEEN.Easing.Exponential.Out),t.start(),this.el.setAttribute("brush","enabled",!1),this.rayEl.setAttribute("visible",!1),this.closed=!1,this.tooltips)){var s=this;this.tooltips.forEach(function(t){t.getAttribute("visible")&&e.parentEl.id!==t.parentEl.id&&(s.isTooltipPaused=!0,t.setAttribute("visible",!1))})}},updateIntersections:function(){var t=this.raycaster=new THREE.Raycaster;return function(e){this.updateRaycaster(t),this.intersectedObjects=t.intersectObjects(this.menuEls,!0)}}(),onIntersection:function(t){var e=this.closed&&this.system.opened;this.el.components.brush.active||(this.rayEl.setAttribute("visible",!!e),this.el.setAttribute("brush","enabled",!1))},onIntersected:function(t){var e=t.detail.el;this.handEl&&this.removeHandListeners(),e.components.ui&&(this.handEl=e,this.handRayEl=this.handEl.components.ui.rayEl,this.menuEls=this.uiEl.object3D.children,this.syncUI())},addHandListeners:function(){var t=this.handEl;t.addEventListener("componentchanged",this.onComponentChanged),t.addEventListener("stroke-started",this.onStrokeStarted),t.addEventListener("triggerchanged",this.onTriggerChanged)},removeHandListeners:function(){var t=this.handEl;t.removeEventListener("componentchanged",this.onComponentChanged),t.removeEventListener("stroke-started",this.onStrokeStarted),t.removeEventListener("triggerchanged",this.onTriggerChanged)},onComponentChanged:function(t){"brush"===t.detail.name&&this.syncUI()},syncUI:function(){var t;this.handEl&&this.objects&&(t=this.handEl.getAttribute("brush"),this.updateSizeSlider(t.size),this.updateColorUI(t.color),this.updateColorHistory())},initColorHistory:function(){for(var t,e=this.objects.currentColor,i=0;i<this.objects.colorHistory.length;i++)t=this.objects.colorHistory[i],t.material=t.material.clone(),t.material.map=this.system.selectedTexture;e.material=e.material.clone(),e.material.map=this.system.selectedTexture,this.updateColorHistory()},updateColorHistory:function(){var t=this.handEl&&this.handEl.getAttribute("brush").color,e=this.colorStack;t||(t=this.el.components.brush.schema.color.default),this.objects.currentColor.material.color.set(t);for(var i=0;i<e.length;i++)t=e[e.length-i-1],this.objects.colorHistory[i].material.color.set(t)},updateSizeSlider:function(t){var e=this.objects.sizeSlider,i=e.geometry.boundingBox,s=this.objects.sizeCursor,n=i.max.x-i.min.x,o=t/AFRAME.components.brush.schema.size.max,r=o*n;s.position.setX(r-this.cursorOffset.x);var a=o+.3;s.scale.set(a,1,a)},updateColorUI:function(t){var e=new THREE.Color(t),i=this.hsv=this.rgb2hsv(e.r,e.g,e.b),s=2*i.h*Math.PI,n=i.s*this.colorWheelSize,o=n*Math.cos(s),r=n*Math.sin(s);this.objects.hueCursor.position.setX(o),this.objects.hueCursor.position.setZ(-r),this.objects.hueWheel.material.uniforms.brightness.value=this.hsv.v,this.objects.brightnessCursor.rotation.y=1.5*this.hsv.v-1.5},updateBrushSelector:function(t){var e=this,i=Object.keys(this.brushButtonsMapping),s=this.brushButtonsMapping;i.forEach(function(i){s[i]===t&&e.selectBrushButton(i)})},onIntersectionCleared:function(){this.checkMenuIntersections=!1,this.rayEl.setAttribute("visible",!1),this.el.setAttribute("brush","enabled",!0)},onIntersectedCleared:function(t){this.handEl&&this.handEl.removeEventListener("triggerchanged",this.onTriggerChanged)},onStrokeStarted:function(){var t,e=this.colorStack;this.colorHasChanged&&(t=this.handEl.getAttribute("brush").color,this.colorHasChanged=!1,7===e.length&&e.shift(),e.push(t),this.syncUI())},updateRaycaster:function(){var t=new THREE.Vector3,e=new THREE.Quaternion,i=new THREE.Vector3,s=new THREE.Vector3;return function(n){var o=this.handEl.object3D;o.updateMatrixWorld(),o.matrixWorld.decompose(s,e,i),t.set(0,0,-1),t.applyAxisAngle(new THREE.Vector3(1,0,0),2*-(this.rayAngle/360)*Math.PI),t.applyQuaternion(e),n.far=this.rayDistance,n.set(s,t)}}(),close:function(){var t,e=this.uiEl,i={x:1,y:1,z:1};this.closed||(t=new AFRAME.TWEEN.Tween(i).to({x:0,y:0,z:0},100).onUpdate(function(){e.setAttribute("scale",this)}).onComplete(function(){e.setAttribute("visible",!1)}).easing(AFRAME.TWEEN.Easing.Exponential.Out),t.start(),this.el.setAttribute("brush","enabled",!0),this.closed=!0,this.tooltips&&this.isTooltipPaused&&(this.isTooltipPaused=!1,this.tooltips.forEach(function(t){t.setAttribute("visible",!0)})))}})},function(t,e){AFRAME.registerComponent("ui-raycaster",{schema:{far:{default:1/0},interval:{default:100},near:{default:0},objects:{default:""},recursive:{default:!0},rotation:{default:0}},init:function(){this.direction=new THREE.Vector3,this.intersectedEls=[],this.objects=null,this.prevCheckTime=void 0,this.raycaster=new THREE.Raycaster,this.updateOriginDirection(),this.refreshObjects=this.refreshObjects.bind(this)},play:function(){this.el.sceneEl.addEventListener("child-attached",this.refreshObjects),this.el.sceneEl.addEventListener("child-detached",this.refreshObjects)},pause:function(){this.el.sceneEl.removeEventListener("child-attached",this.refreshObjects),this.el.sceneEl.removeEventListener("child-detached",this.refreshObjects)},update:function(){var t=this.data,e=this.raycaster;e.far=t.far,e.near=t.near,this.refreshObjects()},refreshObjects:function(){var t,e,i=this.data;if(i.objects)for(e=this.el.sceneEl.querySelectorAll(i.objects),this.objects=[],t=0;t<e.length;t++)this.objects.push(e[t].object3D);else this.objects=this.el.sceneEl.object3D.children},tick:function(t){var e,i,s,n=this.el,o=this.data,r=this.prevCheckTime;r&&t-r<o.interval||(s=this.intersectedEls.slice(),this.updateOriginDirection(),i=this.raycaster.intersectObjects(this.objects,o.recursive),i=i.filter(function(t){return!!t.object.el}),e=this.intersectedEls=i.map(function(t){return t.object.el}),i.forEach(function(t){var e=t.object.el;e.emit("raycaster-intersected",{el:n,intersection:t})}),i.length&&n.emit("raycaster-intersection",{els:e,intersections:i}),s.forEach(function(t){e.indexOf(t)===-1&&(n.emit("raycaster-intersection-cleared",{el:t}),t.emit("raycaster-intersected-cleared",{el:n}))}))},updateOriginDirection:function(){var t=new THREE.Quaternion,e=new THREE.Vector3,i=new THREE.Vector3;return function(){var s=this.el,n=this.direction,o=s.object3D;o.updateMatrixWorld(),o.matrixWorld.decompose(e,t,i),n.set(0,0,-1),n.applyAxisAngle(new THREE.Vector3(1,0,0),this.data.rotation/360*2*Math.PI),n.applyQuaternion(t),this.raycaster.set(e,n)}}()})},function(t,e){AFRAME.registerComponent("xr",{schema:{vr:{default:!0},ar:{default:!0},magicWindow:{default:!0}},init:function(){this.realityChanged=this.realityChanged.bind(this),this.el.sceneEl.addEventListener("loaded",this.sceneLoaded.bind(this)),this.originalVisibility=this.el.getAttribute("visible")},update:function(){this.originalVisibility=this.el.getAttribute("visible"),this.el.setAttribute("visible",this.newVisibility)},sceneLoaded:function(){document.querySelector("a-scene").addEventListener("realityChanged",this.realityChanged)},realityChanged:function(t){void 0!==this.data[t.detail]&&(this.data[t.detail]?this.newVisibility=this.originalVisibility:this.newVisibility=!1,this.el.setAttribute("visible",this.newVisibility))}})},function(t,e){!function(){for(var t={init:function(t,e){this.idx=0,this.geometry=new THREE.BufferGeometry,this.vertices=new Float32Array(3*this.options.maxPoints*3),this.normals=new Float32Array(3*this.options.maxPoints*3),
this.uvs=new Float32Array(2*this.options.maxPoints*2),this.geometry.setDrawRange(0,0),this.geometry.addAttribute("position",new THREE.BufferAttribute(this.vertices,3).setDynamic(!0)),this.geometry.addAttribute("uv",new THREE.BufferAttribute(this.uvs,2).setDynamic(!0)),this.geometry.addAttribute("normal",new THREE.BufferAttribute(this.normals,3).setDynamic(!0));var i=new THREE.Mesh(this.geometry,this.getMaterial());i.drawMode=THREE.TriangleStripDrawMode,i.frustumCulled=!1,i.vertices=this.vertices,this.object3D.add(i)},getMaterial:function(){var t=this.materialOptions.map,e=this.materialOptions.type,i={},s={};t&&(s={map:t,transparent:!0,alphaTest:.5}),i="shaded"===e?{color:this.data.color,roughness:.75,metalness:.25,side:THREE.DoubleSide}:{color:this.data.color,side:THREE.DoubleSide};var n=Object.assign(i,s,this.materialOptions);return delete n.type,"shaded"===e?new THREE.MeshStandardMaterial(n):new THREE.MeshBasicMaterial(n)},addPoint:function(t,e,i,n,o){var r=0;for(s=0;s<this.data.numPoints;s++)this.uvs[r++]=s/(this.data.numPoints-1),this.uvs[r++]=0,this.uvs[r++]=s/(this.data.numPoints-1),this.uvs[r++]=1;var a=new THREE.Vector3;a.set(1,0,0),a.applyQuaternion(e),a.normalize();var h=i.clone(),c=i.clone(),d=this.data.size*n;return h.add(a.clone().multiplyScalar(d/2)),c.add(a.clone().multiplyScalar(-d/2)),this.vertices[this.idx++]=h.x,this.vertices[this.idx++]=h.y,this.vertices[this.idx++]=h.z,this.vertices[this.idx++]=c.x,this.vertices[this.idx++]=c.y,this.vertices[this.idx++]=c.z,this.computeVertexNormals(),this.geometry.attributes.normal.needsUpdate=!0,this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.uv.needsUpdate=!0,this.geometry.setDrawRange(0,2*this.data.numPoints),!0},computeVertexNormals:function(){for(var t=new THREE.Vector3,e=new THREE.Vector3,i=new THREE.Vector3,s=new THREE.Vector3,n=new THREE.Vector3,o=0,r=this.idx;o<r;o++)this.normals[o]=0;var a=!0;for(o=0,r=this.idx;o<r;o+=3)a?(t.fromArray(this.vertices,o),e.fromArray(this.vertices,o+3),i.fromArray(this.vertices,o+6)):(t.fromArray(this.vertices,o+3),e.fromArray(this.vertices,o),i.fromArray(this.vertices,o+6)),a=!a,s.subVectors(i,e),n.subVectors(t,e),s.cross(n),s.normalize(),this.normals[o]+=s.x,this.normals[o+1]+=s.y,this.normals[o+2]+=s.z,this.normals[o+3]+=s.x,this.normals[o+4]+=s.y,this.normals[o+5]+=s.z,this.normals[o+6]+=s.x,this.normals[o+7]+=s.y,this.normals[o+8]+=s.z;for(o=6,r=this.idx-6;o<r;o++)this.normals[o]=this.normals[o]/3;this.normals[3]=this.normals[3]/2,this.normals[4]=this.normals[4]/2,this.normals[5]=this.normals[5]/2,this.normals[this.idx-6]=this.normals[this.idx-6]/2,this.normals[this.idx-6+1]=this.normals[this.idx-6+1]/2,this.normals[this.idx-6+2]=this.normals[this.idx-6+2]/2,this.geometry.normalizeNormals()}},e=[{name:"flat",materialOptions:{type:"flat"},thumbnail:"brushes/thumb_flat.gif"},{name:"smooth",materialOptions:{type:"shaded"},thumbnail:"brushes/thumb_smooth.gif"},{name:"squared-textured",materialOptions:{type:"textured",textureSrc:"brushes/squared_textured.png"},thumbnail:"brushes/thumb_squared_textured.gif"},{name:"line-gradient",materialOptions:{type:"textured",textureSrc:"brushes/line_gradient.png"},thumbnail:"brushes/thumb_line_gradient.gif"},{name:"silky-flat",materialOptions:{type:"textured",textureSrc:"brushes/silky_flat.png"},thumbnail:"brushes/thumb_silky_flat.gif"},{name:"silky-textured",materialOptions:{type:"textured",textureSrc:"brushes/silky_textured.png"},thumbnail:"brushes/thumb_silky_textured.gif"},{name:"lines1",materialOptions:{type:"textured",textureSrc:"brushes/lines1.png"},thumbnail:"brushes/thumb_lines1.gif"},{name:"lines2",materialOptions:{type:"textured",textureSrc:"brushes/lines2.png"},thumbnail:"brushes/thumb_lines2.gif"},{name:"lines3",materialOptions:{type:"textured",textureSrc:"brushes/lines3.png"},thumbnail:"brushes/thumb_lines3.gif"},{name:"lines4",materialOptions:{type:"textured",textureSrc:"brushes/lines4.png"},thumbnail:"brushes/thumb_lines4.gif"},{name:"lines5",materialOptions:{type:"textured",textureSrc:"brushes/lines5.png"},thumbnail:"brushes/thumb_lines5.gif"},{name:"line-grunge1",materialOptions:{type:"textured",textureSrc:"brushes/line_grunge1.png"},thumbnail:"brushes/thumb_line_grunge1.gif"},{name:"line-grunge2",materialOptions:{type:"textured",textureSrc:"brushes/line_grunge2.png"},thumbnail:"brushes/thumb_line_grunge2.gif"},{name:"line-grunge3",materialOptions:{type:"textured",textureSrc:"brushes/line_grunge3.png"},thumbnail:"brushes/thumb_line_grunge3.gif"}],i=new THREE.TextureLoader,s=0;s<e.length;s++){var n=e[s];n.materialOptions.textureSrc&&(n.materialOptions.map=i.load(n.materialOptions.textureSrc),delete n.materialOptions.textureSrc),AFRAME.registerBrush(n.name,Object.assign({},t,{materialOptions:n.materialOptions}),{thumbnail:n.thumbnail,maxPoints:3e3})}}()},function(t,e){!function(){for(var t={init:function(t,e){this.idx=0,this.geometry=new THREE.BufferGeometry,this.vertices=new Float32Array(3*this.options.maxPoints*3*2),this.normals=new Float32Array(3*this.options.maxPoints*3*2),this.uvs=new Float32Array(2*this.options.maxPoints*3*2),this.geometry.setDrawRange(0,0),this.geometry.addAttribute("position",new THREE.BufferAttribute(this.vertices,3).setDynamic(!0)),this.geometry.addAttribute("uv",new THREE.BufferAttribute(this.uvs,2).setDynamic(!0)),this.geometry.addAttribute("normal",new THREE.BufferAttribute(this.normals,3).setDynamic(!0));var i=new THREE.Mesh(this.geometry,this.getMaterial());this.currAngle=0,this.subTextures=1,this.angleJitter=0,this.autoRotate=!1,void 0!==this.materialOptions.subTextures&&(this.subTextures=this.materialOptions.subTextures),this.materialOptions.autoRotate===!0&&(this.autoRotate=!0),void 0!==this.materialOptions.angleJitter&&(this.angleJitter=this.materialOptions.angleJitter,this.angleJitter=2*this.angleJitter-this.angleJitter),i.frustumCulled=!1,i.vertices=this.vertices,this.object3D.add(i)},getMaterial:function(){var t=this.materialOptions.map,e=this.materialOptions.type;return"shaded"===e?new THREE.MeshStandardMaterial({color:this.data.color,side:THREE.DoubleSide,map:t,transparent:!0,alphaTest:.5,roughness:.75,metalness:.25}):new THREE.MeshBasicMaterial({color:this.data.color,side:THREE.DoubleSide,map:t,transparent:!0,alphaTest:.5})},addPoint:function(t,e,i,s,n){var o=Math.PI/2,r=new THREE.Vector3;r.set(1,0,0),r.applyQuaternion(e),r.normalize();var a=new THREE.Vector3;a.set(0,1,0),a.applyQuaternion(e),a.normalize();var h=this.data.size*s/2,c=Math.PI/4+Math.random()*this.angleJitter;this.autoRotate&&(this.currAngle+=.1,c+=this.currAngle);var d=i.clone().add(r.applyAxisAngle(a,c).clone().multiplyScalar(h)),l=i.clone().add(r.applyAxisAngle(a,o).clone().multiplyScalar(h)),u=i.clone().add(r.applyAxisAngle(a,o).clone().multiplyScalar(h)),m=i.clone().add(r.applyAxisAngle(a,o).multiplyScalar(h)),p=this.idx;this.vertices[this.idx++]=d.x,this.vertices[this.idx++]=d.y,this.vertices[this.idx++]=d.z,this.vertices[this.idx++]=l.x,this.vertices[this.idx++]=l.y,this.vertices[this.idx++]=l.z,this.vertices[this.idx++]=u.x,this.vertices[this.idx++]=u.y,this.vertices[this.idx++]=u.z,this.vertices[this.idx++]=u.x,this.vertices[this.idx++]=u.y,this.vertices[this.idx++]=u.z,this.vertices[this.idx++]=m.x,this.vertices[this.idx++]=m.y,this.vertices[this.idx++]=m.z,this.vertices[this.idx++]=d.x,this.vertices[this.idx++]=d.y,this.vertices[this.idx++]=d.z;for(var b=0;b<6;b++)this.normals[p++]=a.x,this.normals[p++]=a.y,this.normals[p++]=a.z;var g=6*this.data.numPoints*2,v=0,E=1;if(this.subTextures>1){var f=Math.floor(Math.random()*this.subTextures);v=1/this.subTextures*f,E=v+1/this.subTextures}return this.uvs[g++]=v,this.uvs[g++]=1,this.uvs[g++]=v,this.uvs[g++]=0,this.uvs[g++]=E,this.uvs[g++]=0,this.uvs[g++]=E,this.uvs[g++]=0,this.uvs[g++]=E,this.uvs[g++]=1,this.uvs[g++]=v,this.uvs[g++]=1,this.geometry.attributes.normal.needsUpdate=!0,this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.uv.needsUpdate=!0,this.geometry.setDrawRange(0,6*this.data.numPoints),!0}},e=[{name:"dots",materialOptions:{type:"shaded",textureSrc:"brushes/stamp_dots.png"},thumbnail:"brushes/thumb_stamp_dots.gif",spacing:.01},{name:"squares",materialOptions:{type:"shaded",textureSrc:"brushes/stamp_squares.png"},thumbnail:"brushes/thumb_stamp_squares.gif",spacing:.01},{name:"column",materialOptions:{type:"shaded",autoRotate:!0,textureSrc:"brushes/stamp_column.png"},thumbnail:"brushes/thumb_stamp_column.gif",spacing:.01},{name:"gear1",materialOptions:{type:"shaded",angleJitter:2*Math.PI,subTextures:2,textureSrc:"brushes/stamp_gear.png"},thumbnail:"brushes/thumb_stamp_gear.gif",spacing:.05},{name:"grunge1",materialOptions:{type:"shaded",angleJitter:2*Math.PI,textureSrc:"brushes/stamp_grunge1.png"},thumbnail:"brushes/stamp_grunge1.png",spacing:.02},{name:"grunge2",materialOptions:{type:"shaded",angleJitter:2*Math.PI,textureSrc:"brushes/stamp_grunge2.png"},thumbnail:"brushes/stamp_grunge2.png",spacing:.02},{name:"grunge3",materialOptions:{type:"shaded",angleJitter:2*Math.PI,textureSrc:"brushes/stamp_grunge3.png"},thumbnail:"brushes/stamp_grunge3.png",spacing:.02},{name:"grunge4",materialOptions:{type:"shaded",angleJitter:2*Math.PI,textureSrc:"brushes/stamp_grunge4.png"},thumbnail:"brushes/stamp_grunge4.png",spacing:.02},{name:"grunge5",materialOptions:{type:"shaded",angleJitter:2*Math.PI,textureSrc:"brushes/stamp_grunge5.png"},thumbnail:"brushes/thumb_stamp_grunge5.gif",spacing:.02},{name:"leaf1",materialOptions:{type:"shaded",angleJitter:Math.PI,textureSrc:"brushes/stamp_leaf1.png"},thumbnail:"brushes/stamp_leaf1.png",spacing:.03},{name:"leaf2",materialOptions:{type:"shaded",angleJitter:60*Math.PI/180,textureSrc:"brushes/stamp_leaf2.png"},thumbnail:"brushes/thumb_stamp_leaf2.gif",spacing:.03},{name:"leaf3",materialOptions:{type:"shaded",angleJitter:60*Math.PI/180,textureSrc:"brushes/stamp_leaf3.png"},thumbnail:"brushes/thumb_stamp_leaf3.gif",spacing:.03},{name:"fur1",materialOptions:{type:"shaded",angleJitter:40*Math.PI/180,subTextures:2,textureSrc:"brushes/stamp_fur1.png"},thumbnail:"brushes/stamp_fur1.png",spacing:.01},{name:"fur2",materialOptions:{type:"shaded",angleJitter:10*Math.PI/180,subTextures:3,textureSrc:"brushes/stamp_fur2.png"},thumbnail:"brushes/stamp_fur2.png",spacing:.01},{name:"grass",materialOptions:{type:"shaded",angleJitter:10*Math.PI/180,subTextures:3,textureSrc:"brushes/stamp_grass.png"},thumbnail:"brushes/thumb_stamp_grass.png",spacing:.03},{name:"bush",materialOptions:{type:"shaded",subTextures:2,textureSrc:"brushes/stamp_bush.png"},thumbnail:"brushes/thumb_stamp_bush.gif",spacing:.04},{name:"star",materialOptions:{type:"shaded",textureSrc:"brushes/stamp_star.png"},thumbnail:"brushes/thumb_stamp_star.png",spacing:.06},{name:"snow",materialOptions:{type:"shaded",angleJitter:2*Math.PI,textureSrc:"brushes/stamp_snow.png"},thumbnail:"brushes/thumb_stamp_snow.png",spacing:.06}],i=new THREE.TextureLoader,s=0;s<e.length;s++){var n=e[s];n.materialOptions.textureSrc&&(n.materialOptions.map=i.load(n.materialOptions.textureSrc),delete n.materialOptions.textureSrc),AFRAME.registerBrush(n.name,Object.assign({},t,{materialOptions:n.materialOptions}),{thumbnail:n.thumbnail,spacing:n.spacing,maxPoints:3e3})}}()},function(t,e){AFRAME.registerBrush("spheres",{init:function(t,e){this.material=new THREE.MeshStandardMaterial({color:this.data.color,roughness:.5,metalness:.5,side:THREE.DoubleSide,shading:THREE.FlatShading}),this.geometry=new THREE.IcosahedronGeometry(1,0)},addPoint:function(t,e,i,s,n){var o=new THREE.Mesh(this.geometry,this.material),r=this.data.size/2*s;return o.scale.set(r,r,r),o.initialScale=o.scale.clone(),o.phase=Math.random()*Math.PI*2,o.position.copy(i),o.rotation.copy(e),this.object3D.add(o),!0},tick:function(t,e){for(var i=0;i<this.object3D.children.length;i++){var s=this.object3D.children[i],n=(Math.sin(s.phase+t/500)+1)/2+.1;s.scale.copy(s.initialScale).multiplyScalar(n)}}},{thumbnail:"brushes/thumb_spheres.gif",spacing:.01})},function(t,e){AFRAME.registerBrush("cubes",{init:function(t,e){this.material=new THREE.MeshStandardMaterial({color:this.data.color,roughness:.5,metalness:.5,side:THREE.DoubleSide,shading:THREE.FlatShading}),this.geometry=new THREE.BoxGeometry(1,1,1)},addPoint:function(t,e,i,s,n){var o=new THREE.Mesh(this.geometry,this.material),r=s*this.data.size*Math.random();return o.scale.set(r,r,r),o.position.copy(i),o.rotation.copy(e),this.object3D.add(o),!0}},{thumbnail:"brushes/thumb_cubes.gif",spacing:.01})},function(t,e){!function(){var t="varying vec2 vUv; \t    void main() { \t      vUv = uv; \t      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 ); \t    }",e="uniform sampler2D tDiffuse; \t    uniform float amount; \t    uniform float time; \t    varying vec2 vUv; \t    \t    vec3 hsv2rgb(vec3 c) { \t        vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0); \t        vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www); \t        return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y); \t    } \t    \t    void main() { \t      float h = mod(vUv.x - time / 3000.0, 1.0); \t      vec4 color = vec4(hsv2rgb(vec3(h, 1.0, 0.5)), 1.0); \t      gl_FragColor = color; \t    }",s=new THREE.ShaderMaterial({vertexShader:t,fragmentShader:e,side:THREE.DoubleSide,uniforms:{time:{type:"f",value:0}}});AFRAME.registerBrush("line-rainbow",{init:function(t,e){this.idx=0,this.geometry=new THREE.BufferGeometry,this.vertices=new Float32Array(3*this.options.maxPoints*3),this.uvs=new Float32Array(2*this.options.maxPoints*2),this.linepositions=new Float32Array(this.options.maxPoints),this.geometry.setDrawRange(0,0),this.geometry.addAttribute("position",new THREE.BufferAttribute(this.vertices,3).setDynamic(!0)),this.geometry.addAttribute("uv",new THREE.BufferAttribute(this.uvs,2).setDynamic(!0)),this.geometry.addAttribute("lineposition",new THREE.BufferAttribute(this.linepositions,1).setDynamic(!0)),this.material=s;var i=new THREE.Mesh(this.geometry,this.material);i.drawMode=THREE.TriangleStripDrawMode,i.frustumCulled=!1,i.vertices=this.vertices,this.object3D.add(i)},addPoint:function(t,e,s,n,o){var r=0;for(i=0;i<this.data.numPoints;i++)this.uvs[r++]=i/(this.data.numPoints-1),this.uvs[r++]=0,this.uvs[r++]=i/(this.data.numPoints-1),this.uvs[r++]=1;var a=new THREE.Vector3;a.set(1,0,0),a.applyQuaternion(e),a.normalize();var h=s.clone(),c=s.clone(),d=this.data.size*n;return h.add(a.clone().multiplyScalar(d/2)),c.add(a.clone().multiplyScalar(-d/2)),this.vertices[this.idx++]=h.x,this.vertices[this.idx++]=h.y,this.vertices[this.idx++]=h.z,this.vertices[this.idx++]=c.x,this.vertices[this.idx++]=c.y,this.vertices[this.idx++]=c.z,this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.uv.needsUpdate=!0,this.geometry.setDrawRange(0,2*this.data.numPoints),!0},tick:function(t,e){this.material.uniforms.time.value=t}},{thumbnail:"brushes/thumb_rainbow.png",maxPoints:3e3})}()},function(t,e){AFRAME.registerBrush("single-sphere",{init:function(t,e){this.material=new THREE.MeshStandardMaterial({color:this.data.color,roughness:.6,metalness:.2,side:THREE.FrontSide,shading:THREE.SmoothShading}),this.geometry=new THREE.IcosahedronGeometry(1,2),this.mesh=new THREE.Mesh(this.geometry,this.material),this.object3D.add(this.mesh),this.mesh.visible=!1},addPoint:function(t,e,i,s,n){this.firstPoint||(this.firstPoint=i.clone(),this.mesh.position.set(this.firstPoint.x,this.firstPoint.y,this.firstPoint.z)),this.mesh.visible=!0;var o=this.firstPoint.distanceTo(i);return this.mesh.scale.set(o,o,o),!0}},{thumbnail:"brushes/thumb_single_sphere.png",spacing:0})},function(t,e){AFRAME.registerComponent("ar-paint-normal",{schema:{brush:{default:"smooth"},color:{default:"#ef2d5e"},size:{default:.1},defaultSize:{default:.01},min:{default:.001},max:{default:.3}},init:function(){this.bindMethods(),this.initVars(),this.tempCamera=new THREE.PerspectiveCamera,document.querySelector("[ar-paint-controls]").addEventListener("brushchanged",this.onBrushChanged),document.querySelector("[ar-paint-controls]").addEventListener("paintplaced",this.onPaintPlaced),document.querySelector("[ar-paint-controls]").addEventListener("paintstarted",this.onPaintStarted),document.querySelector("[ar-paint-controls]").addEventListener("paintpainting",this.onPaintPainting),document.querySelector("[ar-paint-controls]").addEventListener("paintended",this.onPaintEnded),document.querySelector("a-scene").addEventListener("updateFrame",this.updateFrame)},bindMethods:function(){this.onBrushChanged=this.onBrushChanged.bind(this),this.onPaintPlaced=this.onPaintPlaced.bind(this),this.onPaintStarted=this.onPaintStarted.bind(this),this.onPaintPainting=this.onPaintPainting.bind(this),this.onPaintEnded=this.onPaintEnded.bind(this),this.updateFrame=this.updateFrame.bind(this)},initVars:function(){this.pressure=0,this.normalizedCoordinatedPositionPointer=new THREE.Vector2,this.pointerPosition=new THREE.Vector3,this.raycaster=new THREE.Raycaster,this.ray=this.raycaster.ray},onBrushChanged:function(t){this.el.setAttribute("material","color",t.detail.brush.color),this.pressure=t.detail.pressure},onPaintPlaced:function(t){this.el.setAttribute("visible",!0),this.eventTouch=null},onPaintStarted:function(t){this.eventTouch=t.detail.touchEvent,this.strokeStarted=!1,this.brush=t.detail.brush},onPaintPainting:function(t){this.stylusActive=t.detail.stylusActive,this.eventTouch=t.detail.touchEvent},onPaintEnded:function(){this.eventTouch=null,this.el.setAttribute("visible",!1),this.strokeStarted=!1},updatePointerPosition:function(t){if(t){var e=t;t.touches&&(e=t.touches[0]),this.normalizedCoordinatedPositionPointer.x=e.clientX/this.el.sceneEl.canvas.clientWidth*2-1,this.normalizedCoordinatedPositionPointer.y=2*-(e.clientY/this.el.sceneEl.canvas.clientHeight)+1}else this.normalizedCoordinatedPositionPointer.x=0,this.normalizedCoordinatedPositionPointer.y=0;this.tempCamera.matrixWorld=this.el.sceneEl.camera.matrixWorld,this.tempCamera.projectionMatrix=this.el.sceneEl.camera.projectionMatrix,this.raycaster.setFromCamera(this.normalizedCoordinatedPositionPointer,this.tempCamera),this.pointerPosition.copy(this.ray.direction),this.pointerPosition.multiplyScalar(.5),this.pointerPosition.add(this.ray.origin),this.el.setAttribute("position",{x:this.pointerPosition.x,y:this.pointerPosition.y,z:this.pointerPosition.z}),!this.strokeStarted&&t&&(this.strokeStarted=!0,this.brush.sizeModifier=0,this.brush.startNewStroke(),this.brush.active=!0)},pause:function(){document.querySelector("[ar-paint-controls]")&&(document.querySelector("[ar-paint-controls]").removeEventListener("bushchanged",this.onBrushChanged),document.querySelector("[ar-paint-controls]").removeEventListener("paintplaced",this.onPaintPlaced),document.querySelector("[ar-paint-controls]").removeEventListener("paintstarted",this.onPaintStarted),document.querySelector("[ar-paint-controls]").removeEventListener("paintpainting",this.onPaintPainting),document.querySelector("[ar-paint-controls]").removeEventListener("paintended",this.onPaintEnded)),document.querySelector("a-scene").removeEventListener("updateFrame",this.updateFrame)},updateFrame:function(t){this.el.object3D.lookAt(this.el.sceneEl.camera.getWorldPosition());var e=t.detail,i=e.getDisplayPose(e.getCoordinateSystem(XRCoordinateSystem.HEAD_MODEL)),s=new THREE.Matrix4,n=new THREE.Vector3,o=new THREE.Quaternion,r=new THREE.Vector3;s.fromArray(i.poseModelMatrix).decompose(n,o,r);var a=new THREE.Vector3,h=new THREE.Quaternion,c=new THREE.Vector3,d=.1;a=this.tempCamera.getWorldPosition(),h=this.tempCamera.getWorldQuaternion(),c=this.tempCamera.getWorldScale(),a.lerp(n,d),h.slerp(o,d),c.lerp(r,d),this.tempCamera.matrixAutoUpdate=!1,this.tempCamera.matrix.compose(a,h,c),this.tempCamera.updateMatrixWorld(!0),this.updatePointerPosition(this.eventTouch)}})},function(t,e){AFRAME.registerComponent("ar-paint-advanced",{schema:{brush:{default:"smooth"},color:{default:"#ef2d5e"},size:{default:.1},defaultSize:{default:.01},min:{default:.001},max:{default:.3}},init:function(){this.bindMethods(),this.initVars(),this.addPointer(),this.addPointerShadow(),this.addConnectedLine(),this.addImpliedPlane(),this.setPointerScale(this.data.size,!1),document.querySelector("[ar-paint-controls]").addEventListener("brushchanged",this.onBrushChanged),document.querySelector("[ar-paint-controls]").addEventListener("paintplaced",this.onPaintPlaced),document.querySelector("[ar-paint-controls]").addEventListener("paintstarted",this.onPaintStarted),document.querySelector("[ar-paint-controls]").addEventListener("paintpainting",this.onPaintPainting),document.querySelector("[ar-paint-controls]").addEventListener("paintended",this.onPaintEnded),document.querySelector("a-scene").addEventListener("updateFrame",this.updateFrame)},bindMethods:function(){this.onBrushChanged=this.onBrushChanged.bind(this),this.onPaintPlaced=this.onPaintPlaced.bind(this),this.onPaintStarted=this.onPaintStarted.bind(this),this.onPaintPainting=this.onPaintPainting.bind(this),this.onPaintEnded=this.onPaintEnded.bind(this),this.updateFrame=this.updateFrame.bind(this)},initVars:function(){this.pointerScale=this.data.scale,this.isPainting=!1,this.pressure=0,this.normalizedCoordinatedPositionPointer=new THREE.Vector2,this.pointerPosition=new THREE.Vector3,this.raycaster=new THREE.Raycaster,this.ray=this.raycaster.ray,this.tempCamera=new THREE.PerspectiveCamera},addPointer:function(){this.pointer=new THREE.Group,document.querySelector("#drawing-container").object3D.add(this.pointer)},addPointerShadow:function(){var t=new THREE.Shape;t.absarc(0,0,.0045,0,2*Math.PI,!1);var e=new THREE.ShapeGeometry(t);e.vertices.push(e.vertices[0].clone()),e.applyMatrix((new THREE.Matrix4).makeRotationX(THREE.Math.degToRad(-90))),this.pointerShadow=new THREE.Line(e,new THREE.LineBasicMaterial),document.querySelector("#drawing-container").object3D.add(this.pointerShadow)},addConnectedLine:function(){var t=new THREE.Geometry;t.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,.1,0)),t.computeLineDistances();var e=new THREE.LineDashedMaterial({color:16777215,dashSize:.0045,gapSize:.0045,transparent:!1});this.connectedLine=new THREE.Line(t,e),this.connectedLine.frustumCulled=!1,document.querySelector("#drawing-container").object3D.add(this.connectedLine)},addImpliedPlane:function(){var t=new THREE.Shape,e=.08*window.innerWidth/window.innerHeight,i=.08;t.moveTo(0,0),t.lineTo(e,0),t.lineTo(e,i),t.lineTo(0,i),t.lineTo(0,0);var s=new THREE.ShapeGeometry(t);s.translate(-e/2,-i/2,0),s.vertices.push(s.vertices[0].clone()),s.computeLineDistances();var n=new THREE.LineDashedMaterial({color:16777215,dashSize:.0045,gapSize:.0045});this.impliedPlane=new THREE.Line(s,n),this.pointer.add(this.impliedPlane);var o=new THREE.PlaneGeometry(e,i),r=new THREE.MeshBasicMaterial({color:16777215,transparent:!0,opacity:.4});r.blending=THREE.CustomBlending,r.blendEquation=THREE.AddEquation,r.blendSrc=THREE.ZeroFactor,r.blendDst=THREE.SrcAlphaFactor;var a=new THREE.Mesh(o,r);this.impliedPlane.add(a)},onBrushChanged:function(t){this.pressure=t.detail.pressure,this.setPointerScale(t.detail.brush.size,t.detail.uiTouched)},setPointerScale:function(t,e){if(t>this.data.defaultSize?this.pointerScale=THREE.Math.mapLinear(t,this.data.defaultSize,this.data.max,1,30):this.pointerScale=THREE.Math.mapLinear(t,this.data.defaultSize,this.data.min,1,.25),this.stylusActive){var i=Math.max(.1,this.pointerScale*this.pressure);e&&(i=.1*this.pointerScale),this.pointer.scale.set(i,i,i)}else this.pointer.scale.set(this.pointerScale,this.pointerScale,this.pointerScale);this.pointerShadow.scale.set(this.pointer.scale.x,this.pointer.scale.y,this.pointer.scale.z),this.connectedLine.scale.set(this.pointer.scale.x,this.pointer.scale.y,this.pointer.scale.z)},onPaintPlaced:function(t){this.eventTouch=null},onPaintStarted:function(t){this.eventTouch=t.detail.touchEvent,this.strokeStarted=!1,this.brush=t.detail.brush,this.isPainting=!0},onPaintPainting:function(t){!t.detail.stylusActive&&this.stylusActive&&(this.pointer.scale.set(this.pointerScale,this.pointerScale,this.pointerScale),this.pointerShadow.scale.set(this.pointerScale,this.pointerScale,this.pointerScale),this.connectedLine.scale.set(this.pointerScale,this.pointerScale,this.pointerScale)),this.stylusActive=t.detail.stylusActive,this.eventTouch=t.detail.touchEvent},onPaintEnded:function(){this.eventTouch=null,this.isPainting=!1,this.strokeStarted=!1},updatePointerPosition:function(t){if(t){var e=t;t.touches&&(e=t.touches[0]),this.normalizedCoordinatedPositionPointer.x=e.clientX/this.el.sceneEl.canvas.clientWidth*2-1,this.normalizedCoordinatedPositionPointer.y=2*-(e.clientY/this.el.sceneEl.canvas.clientHeight)+1}else this.normalizedCoordinatedPositionPointer.x=0,this.normalizedCoordinatedPositionPointer.y=0;this.tempCamera.matrixWorld=this.el.sceneEl.camera.matrixWorld,this.tempCamera.projectionMatrix=this.el.sceneEl.camera.projectionMatrix,this.raycaster.setFromCamera(this.normalizedCoordinatedPositionPointer,this.tempCamera),this.pointerPosition.copy(this.ray.direction),this.pointerPosition.multiplyScalar(.5),this.pointerPosition.add(this.ray.origin),this.el.object3D.position.set(this.pointerPosition.x,this.pointerPosition.y,this.pointerPosition.z),this.pointer.position.set(this.pointerPosition.x,this.pointerPosition.y,this.pointerPosition.z),this.pointerShadow.position.set(this.pointerPosition.x,AFRAME.scenes[0].object3D.drawingOffset.y,this.pointerPosition.z),this.connectedLine.position.set(this.pointerPosition.x,AFRAME.scenes[0].object3D.drawingOffset.y,this.pointerPosition.z),!this.strokeStarted&&t&&(this.strokeStarted=!0,this.brush.sizeModifier=0,this.brush.startNewStroke(),this.brush.active=!0)},pause:function(){document.querySelector("[ar-paint-controls]").removeEventListener("bushchanged",this.onBrushChanged),document.querySelector("[ar-paint-controls]").removeEventListener("paintplaced",this.onPaintPlaced),document.querySelector("[ar-paint-controls]").removeEventListener("paintstarted",this.onPaintStarted),document.querySelector("[ar-paint-controls]").removeEventListener("paintpainting",this.onPaintPainting),document.querySelector("[ar-paint-controls]").removeEventListener("paintended",this.onPaintEnded),document.querySelector("a-scene").removeEventListener("updateFrame",this.updateFrame),this.impliedPlane.remove(this.impliedGlass),this.pointer.remove(this.impliedPlane),document.querySelector("#drawing-container").object3D.remove(this.pointer),document.querySelector("#drawing-container").object3D.remove(this.pointerShadow),document.querySelector("#drawing-container").object3D.remove(this.connectedLine)},updateFrame:function(t){this.pointer.lookAt(this.el.sceneEl.camera.getWorldPosition());var e=this.pointer.getWorldPosition().y-this.pointerShadow.getWorldPosition().y;e>0?(this.impliedPlane.material.gapSize=0,this.connectedLine.material.gapSize=0,this.pointerShadow.material.opacity=.5):(this.impliedPlane.material.gapSize=.0045,this.connectedLine.material.gapSize=.0045/this.pointerShadow.scale.y,this.connectedLine.material.dashSize=.0045/this.pointerShadow.scale.y,this.pointerShadow.material.opacity=0),this.connectedLine.geometry.vertices[1].y=e/this.pointerShadow.scale.y,this.connectedLine.geometry.verticesNeedUpdate=!0,this.connectedLine.geometry.computeLineDistances(),this.connectedLine.geometry.lineDistancesNeedUpdate=!0;var i=THREE.Math.mapLinear(this.pointerShadow.scale.x,.25,30,.5,4),s=1/this.pointerShadow.scale.x*i;this.impliedPlane.scale.set(s,s,s),this.updatePointerPosition(this.eventTouch);var n=t.detail,o=n.getDisplayPose(n.getCoordinateSystem(XRCoordinateSystem.HEAD_MODEL)),r=new THREE.Matrix4,a=new THREE.Vector3,h=new THREE.Quaternion,c=new THREE.Vector3;r.fromArray(o.poseModelMatrix).decompose(a,h,c);var d=new THREE.Vector3,l=new THREE.Quaternion,u=new THREE.Vector3,m=.1;d=this.tempCamera.getWorldPosition(),l=this.tempCamera.getWorldQuaternion(),u=this.tempCamera.getWorldScale(),d.lerp(a,m),l.slerp(h,m),u.lerp(c,m),this.tempCamera.matrixAutoUpdate=!1,this.tempCamera.matrix.compose(d,l,u),this.tempCamera.updateMatrixWorld(!0)}})}]);